
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../capsulization/">
      
      
        <link rel="next" href="../holon-data-loader-design-spec/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.11">
    
    
      
        <title>Trust Channel Design Spec - MAP Developer Docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="cyan">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#map-trust-channel-developer-design-spec-fully-expanded" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="MAP Developer Docs" class="md-header__button md-logo" aria-label="MAP Developer Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            MAP Developer Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Trust Channel Design Spec
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="cyan"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="cyan"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="MAP Developer Docs" class="md-nav__button md-logo" aria-label="MAP Developer Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    MAP Developer Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Mapp Developers
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Mapp Developers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mapp-dev/rust-api-developers-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Developers Guide to the MAP Rust-API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mapp-dev/holon-data-loader-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Holon Data Loader Guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mapp-dev/holon-loader-man-page/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Holon Data Loader CLI Man Page
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mapp-dev/tags_to_memes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tags to Memes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mapp-dev/extensibility-model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    The MAP Extensibility Model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mapp-dev/trust-channel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Trust Channels
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Visualizer Developers
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    MAP Core
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            MAP Core
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../map-type-system-revised/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MAP Type System
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../transaction-model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MAP Transaction Model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../on-boarding/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    On-Boarding Flow
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dances-design/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dances Design Spec
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../capsulization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Capsulization Strategy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Trust Channel Design Spec
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Trust Channel Design Spec
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#0-purpose-scope" class="md-nav__link">
    <span class="md-ellipsis">
      0. Purpose &amp; Scope
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-deployment-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      1. Deployment Architecture
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Deployment Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-system-topology-overview" class="md-nav__link">
    <span class="md-ellipsis">
      1.1 System Topology Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-trust-channel-cross-section" class="md-nav__link">
    <span class="md-ellipsis">
      1.2 Trust Channel Cross-Section
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-core-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      2. Core Concepts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Core Concepts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-dance-capsule" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 Dance Capsule
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-agreement-and-protocolsuite" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 Agreement and ProtocolSuite
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-protocol-negotiation" class="md-nav__link">
    <span class="md-ellipsis">
      2.3 Protocol Negotiation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-envelope-layer-reference-expanded" class="md-nav__link">
    <span class="md-ellipsis">
      3. Envelope Layer Reference (Expanded)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Envelope Layer Reference (Expanded)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-transport-envelope" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 Transport Envelope
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.1 Transport Envelope">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#conceptual-purpose" class="md-nav__link">
    <span class="md-ellipsis">
      Conceptual Purpose
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#holon-type-and-relationships" class="md-nav__link">
    <span class="md-ellipsis">
      Holon Type and Relationships
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-data-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Key Data Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#processing-steps" class="md-nav__link">
    <span class="md-ellipsis">
      Processing Steps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#expected-outcome" class="md-nav__link">
    <span class="md-ellipsis">
      Expected Outcome
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#developer-guidance" class="md-nav__link">
    <span class="md-ellipsis">
      Developer Guidance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-authentication-envelope-authn" class="md-nav__link">
    <span class="md-ellipsis">
      3.2 Authentication Envelope (AuthN)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.2 Authentication Envelope (AuthN)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#conceptual-purpose_1" class="md-nav__link">
    <span class="md-ellipsis">
      Conceptual Purpose
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#holon-type-and-relationships_1" class="md-nav__link">
    <span class="md-ellipsis">
      Holon Type and Relationships
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-data-fields_1" class="md-nav__link">
    <span class="md-ellipsis">
      Key Data Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#processing-steps_1" class="md-nav__link">
    <span class="md-ellipsis">
      Processing Steps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#expected-outcome_1" class="md-nav__link">
    <span class="md-ellipsis">
      Expected Outcome
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#developer-guidance_1" class="md-nav__link">
    <span class="md-ellipsis">
      Developer Guidance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-cryptography-envelope-crypto" class="md-nav__link">
    <span class="md-ellipsis">
      3.3 Cryptography Envelope (Crypto)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.3 Cryptography Envelope (Crypto)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#conceptual-purpose_2" class="md-nav__link">
    <span class="md-ellipsis">
      Conceptual Purpose
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#holon-type-and-relationships_2" class="md-nav__link">
    <span class="md-ellipsis">
      Holon Type and Relationships
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-data-fields_2" class="md-nav__link">
    <span class="md-ellipsis">
      Key Data Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#processing-steps_2" class="md-nav__link">
    <span class="md-ellipsis">
      Processing Steps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#expected-outcome_2" class="md-nav__link">
    <span class="md-ellipsis">
      Expected Outcome
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#developer-guidance_2" class="md-nav__link">
    <span class="md-ellipsis">
      Developer Guidance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34-authorization-envelope-authz" class="md-nav__link">
    <span class="md-ellipsis">
      3.4 Authorization Envelope (AuthZ)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.4 Authorization Envelope (AuthZ)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#conceptual-purpose_3" class="md-nav__link">
    <span class="md-ellipsis">
      Conceptual Purpose
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#holon-type-and-relationships_3" class="md-nav__link">
    <span class="md-ellipsis">
      Holon Type and Relationships
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-data-fields_3" class="md-nav__link">
    <span class="md-ellipsis">
      Key Data Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#processing-steps_3" class="md-nav__link">
    <span class="md-ellipsis">
      Processing Steps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#expected-outcome_3" class="md-nav__link">
    <span class="md-ellipsis">
      Expected Outcome
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#developer-guidance_3" class="md-nav__link">
    <span class="md-ellipsis">
      Developer Guidance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#35-dispatch-envelope" class="md-nav__link">
    <span class="md-ellipsis">
      3.5 Dispatch Envelope
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.5 Dispatch Envelope">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#conceptual-purpose_4" class="md-nav__link">
    <span class="md-ellipsis">
      Conceptual Purpose
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#holon-type-and-relationships_4" class="md-nav__link">
    <span class="md-ellipsis">
      Holon Type and Relationships
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-data-fields_4" class="md-nav__link">
    <span class="md-ellipsis">
      Key Data Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#processing-steps_4" class="md-nav__link">
    <span class="md-ellipsis">
      Processing Steps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#expected-outcome_4" class="md-nav__link">
    <span class="md-ellipsis">
      Expected Outcome
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#developer-guidance_4" class="md-nav__link">
    <span class="md-ellipsis">
      Developer Guidance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#36-payload-envelope" class="md-nav__link">
    <span class="md-ellipsis">
      3.6 Payload Envelope
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.6 Payload Envelope">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#conceptual-purpose_5" class="md-nav__link">
    <span class="md-ellipsis">
      Conceptual Purpose
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#holon-type-and-relationships_5" class="md-nav__link">
    <span class="md-ellipsis">
      Holon Type and Relationships
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-data-fields_5" class="md-nav__link">
    <span class="md-ellipsis">
      Key Data Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#processing-steps_5" class="md-nav__link">
    <span class="md-ellipsis">
      Processing Steps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#expected-outcome_5" class="md-nav__link">
    <span class="md-ellipsis">
      Expected Outcome
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#developer-guidance_5" class="md-nav__link">
    <span class="md-ellipsis">
      Developer Guidance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#37-exfiltration-envelope-outbound" class="md-nav__link">
    <span class="md-ellipsis">
      3.7 Exfiltration Envelope (Outbound)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.7 Exfiltration Envelope (Outbound)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#conceptual-purpose_6" class="md-nav__link">
    <span class="md-ellipsis">
      Conceptual Purpose
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#holon-type-and-relationships_6" class="md-nav__link">
    <span class="md-ellipsis">
      Holon Type and Relationships
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-data-fields_6" class="md-nav__link">
    <span class="md-ellipsis">
      Key Data Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#processing-steps_6" class="md-nav__link">
    <span class="md-ellipsis">
      Processing Steps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#expected-outcome_6" class="md-nav__link">
    <span class="md-ellipsis">
      Expected Outcome
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#developer-guidance_6" class="md-nav__link">
    <span class="md-ellipsis">
      Developer Guidance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#38-unlock-envelope-optional" class="md-nav__link">
    <span class="md-ellipsis">
      3.8 Unlock Envelope (Optional)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.8 Unlock Envelope (Optional)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#conceptual-purpose_7" class="md-nav__link">
    <span class="md-ellipsis">
      Conceptual Purpose
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#holon-type-and-relationships_7" class="md-nav__link">
    <span class="md-ellipsis">
      Holon Type and Relationships
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-data-fields_7" class="md-nav__link">
    <span class="md-ellipsis">
      Key Data Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#processing-steps_7" class="md-nav__link">
    <span class="md-ellipsis">
      Processing Steps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#expected-outcome_7" class="md-nav__link">
    <span class="md-ellipsis">
      Expected Outcome
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#developer-guidance_7" class="md-nav__link">
    <span class="md-ellipsis">
      Developer Guidance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#39-sessionstate-envelope-optional" class="md-nav__link">
    <span class="md-ellipsis">
      3.9 SessionState Envelope (Optional)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.9 SessionState Envelope (Optional)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#conceptual-purpose_8" class="md-nav__link">
    <span class="md-ellipsis">
      Conceptual Purpose
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#holon-type-and-relationships_8" class="md-nav__link">
    <span class="md-ellipsis">
      Holon Type and Relationships
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-data-fields_8" class="md-nav__link">
    <span class="md-ellipsis">
      Key Data Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#processing-steps_8" class="md-nav__link">
    <span class="md-ellipsis">
      Processing Steps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#expected-outcome_8" class="md-nav__link">
    <span class="md-ellipsis">
      Expected Outcome
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#developer-guidance_8" class="md-nav__link">
    <span class="md-ellipsis">
      Developer Guidance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-lifecycle-overview" class="md-nav__link">
    <span class="md-ellipsis">
      4. Lifecycle Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      5. Error Handling
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-implementation-notes" class="md-nav__link">
    <span class="md-ellipsis">
      6. Implementation Notes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-summary" class="md-nav__link">
    <span class="md-ellipsis">
      7. Summary
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../holon-data-loader-design-spec/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Holon Loader Spec
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../meta-value-types-import-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Meta-Value Import Guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../i18n-design-spec/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Internationalization Design Spec
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Shared Concepts
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../shared/glossary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Glossary
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#0-purpose-scope" class="md-nav__link">
    <span class="md-ellipsis">
      0. Purpose &amp; Scope
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-deployment-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      1. Deployment Architecture
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Deployment Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-system-topology-overview" class="md-nav__link">
    <span class="md-ellipsis">
      1.1 System Topology Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-trust-channel-cross-section" class="md-nav__link">
    <span class="md-ellipsis">
      1.2 Trust Channel Cross-Section
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-core-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      2. Core Concepts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Core Concepts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-dance-capsule" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 Dance Capsule
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-agreement-and-protocolsuite" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 Agreement and ProtocolSuite
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-protocol-negotiation" class="md-nav__link">
    <span class="md-ellipsis">
      2.3 Protocol Negotiation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-envelope-layer-reference-expanded" class="md-nav__link">
    <span class="md-ellipsis">
      3. Envelope Layer Reference (Expanded)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Envelope Layer Reference (Expanded)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-transport-envelope" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 Transport Envelope
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.1 Transport Envelope">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#conceptual-purpose" class="md-nav__link">
    <span class="md-ellipsis">
      Conceptual Purpose
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#holon-type-and-relationships" class="md-nav__link">
    <span class="md-ellipsis">
      Holon Type and Relationships
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-data-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Key Data Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#processing-steps" class="md-nav__link">
    <span class="md-ellipsis">
      Processing Steps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#expected-outcome" class="md-nav__link">
    <span class="md-ellipsis">
      Expected Outcome
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#developer-guidance" class="md-nav__link">
    <span class="md-ellipsis">
      Developer Guidance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-authentication-envelope-authn" class="md-nav__link">
    <span class="md-ellipsis">
      3.2 Authentication Envelope (AuthN)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.2 Authentication Envelope (AuthN)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#conceptual-purpose_1" class="md-nav__link">
    <span class="md-ellipsis">
      Conceptual Purpose
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#holon-type-and-relationships_1" class="md-nav__link">
    <span class="md-ellipsis">
      Holon Type and Relationships
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-data-fields_1" class="md-nav__link">
    <span class="md-ellipsis">
      Key Data Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#processing-steps_1" class="md-nav__link">
    <span class="md-ellipsis">
      Processing Steps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#expected-outcome_1" class="md-nav__link">
    <span class="md-ellipsis">
      Expected Outcome
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#developer-guidance_1" class="md-nav__link">
    <span class="md-ellipsis">
      Developer Guidance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-cryptography-envelope-crypto" class="md-nav__link">
    <span class="md-ellipsis">
      3.3 Cryptography Envelope (Crypto)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.3 Cryptography Envelope (Crypto)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#conceptual-purpose_2" class="md-nav__link">
    <span class="md-ellipsis">
      Conceptual Purpose
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#holon-type-and-relationships_2" class="md-nav__link">
    <span class="md-ellipsis">
      Holon Type and Relationships
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-data-fields_2" class="md-nav__link">
    <span class="md-ellipsis">
      Key Data Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#processing-steps_2" class="md-nav__link">
    <span class="md-ellipsis">
      Processing Steps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#expected-outcome_2" class="md-nav__link">
    <span class="md-ellipsis">
      Expected Outcome
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#developer-guidance_2" class="md-nav__link">
    <span class="md-ellipsis">
      Developer Guidance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34-authorization-envelope-authz" class="md-nav__link">
    <span class="md-ellipsis">
      3.4 Authorization Envelope (AuthZ)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.4 Authorization Envelope (AuthZ)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#conceptual-purpose_3" class="md-nav__link">
    <span class="md-ellipsis">
      Conceptual Purpose
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#holon-type-and-relationships_3" class="md-nav__link">
    <span class="md-ellipsis">
      Holon Type and Relationships
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-data-fields_3" class="md-nav__link">
    <span class="md-ellipsis">
      Key Data Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#processing-steps_3" class="md-nav__link">
    <span class="md-ellipsis">
      Processing Steps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#expected-outcome_3" class="md-nav__link">
    <span class="md-ellipsis">
      Expected Outcome
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#developer-guidance_3" class="md-nav__link">
    <span class="md-ellipsis">
      Developer Guidance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#35-dispatch-envelope" class="md-nav__link">
    <span class="md-ellipsis">
      3.5 Dispatch Envelope
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.5 Dispatch Envelope">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#conceptual-purpose_4" class="md-nav__link">
    <span class="md-ellipsis">
      Conceptual Purpose
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#holon-type-and-relationships_4" class="md-nav__link">
    <span class="md-ellipsis">
      Holon Type and Relationships
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-data-fields_4" class="md-nav__link">
    <span class="md-ellipsis">
      Key Data Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#processing-steps_4" class="md-nav__link">
    <span class="md-ellipsis">
      Processing Steps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#expected-outcome_4" class="md-nav__link">
    <span class="md-ellipsis">
      Expected Outcome
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#developer-guidance_4" class="md-nav__link">
    <span class="md-ellipsis">
      Developer Guidance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#36-payload-envelope" class="md-nav__link">
    <span class="md-ellipsis">
      3.6 Payload Envelope
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.6 Payload Envelope">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#conceptual-purpose_5" class="md-nav__link">
    <span class="md-ellipsis">
      Conceptual Purpose
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#holon-type-and-relationships_5" class="md-nav__link">
    <span class="md-ellipsis">
      Holon Type and Relationships
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-data-fields_5" class="md-nav__link">
    <span class="md-ellipsis">
      Key Data Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#processing-steps_5" class="md-nav__link">
    <span class="md-ellipsis">
      Processing Steps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#expected-outcome_5" class="md-nav__link">
    <span class="md-ellipsis">
      Expected Outcome
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#developer-guidance_5" class="md-nav__link">
    <span class="md-ellipsis">
      Developer Guidance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#37-exfiltration-envelope-outbound" class="md-nav__link">
    <span class="md-ellipsis">
      3.7 Exfiltration Envelope (Outbound)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.7 Exfiltration Envelope (Outbound)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#conceptual-purpose_6" class="md-nav__link">
    <span class="md-ellipsis">
      Conceptual Purpose
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#holon-type-and-relationships_6" class="md-nav__link">
    <span class="md-ellipsis">
      Holon Type and Relationships
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-data-fields_6" class="md-nav__link">
    <span class="md-ellipsis">
      Key Data Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#processing-steps_6" class="md-nav__link">
    <span class="md-ellipsis">
      Processing Steps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#expected-outcome_6" class="md-nav__link">
    <span class="md-ellipsis">
      Expected Outcome
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#developer-guidance_6" class="md-nav__link">
    <span class="md-ellipsis">
      Developer Guidance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#38-unlock-envelope-optional" class="md-nav__link">
    <span class="md-ellipsis">
      3.8 Unlock Envelope (Optional)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.8 Unlock Envelope (Optional)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#conceptual-purpose_7" class="md-nav__link">
    <span class="md-ellipsis">
      Conceptual Purpose
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#holon-type-and-relationships_7" class="md-nav__link">
    <span class="md-ellipsis">
      Holon Type and Relationships
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-data-fields_7" class="md-nav__link">
    <span class="md-ellipsis">
      Key Data Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#processing-steps_7" class="md-nav__link">
    <span class="md-ellipsis">
      Processing Steps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#expected-outcome_7" class="md-nav__link">
    <span class="md-ellipsis">
      Expected Outcome
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#developer-guidance_7" class="md-nav__link">
    <span class="md-ellipsis">
      Developer Guidance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#39-sessionstate-envelope-optional" class="md-nav__link">
    <span class="md-ellipsis">
      3.9 SessionState Envelope (Optional)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.9 SessionState Envelope (Optional)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#conceptual-purpose_8" class="md-nav__link">
    <span class="md-ellipsis">
      Conceptual Purpose
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#holon-type-and-relationships_8" class="md-nav__link">
    <span class="md-ellipsis">
      Holon Type and Relationships
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-data-fields_8" class="md-nav__link">
    <span class="md-ellipsis">
      Key Data Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#processing-steps_8" class="md-nav__link">
    <span class="md-ellipsis">
      Processing Steps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#expected-outcome_8" class="md-nav__link">
    <span class="md-ellipsis">
      Expected Outcome
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#developer-guidance_8" class="md-nav__link">
    <span class="md-ellipsis">
      Developer Guidance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-lifecycle-overview" class="md-nav__link">
    <span class="md-ellipsis">
      4. Lifecycle Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      5. Error Handling
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-implementation-notes" class="md-nav__link">
    <span class="md-ellipsis">
      6. Implementation Notes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-summary" class="md-nav__link">
    <span class="md-ellipsis">
      7. Summary
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="map-trust-channel-developer-design-spec-fully-expanded">MAP Trust Channel — Developer Design Spec (Fully Expanded)<a class="headerlink" href="#map-trust-channel-developer-design-spec-fully-expanded" title="Permanent link">&para;</a></h1>
<h2 id="0-purpose-scope">0. Purpose &amp; Scope<a class="headerlink" href="#0-purpose-scope" title="Permanent link">&para;</a></h2>
<p>The <strong>Trust Channel</strong> is the MAP core service that encapsulates, transports, and validates <strong>Dance Capsules</strong> whenever an interaction crosses a <strong>membrane boundary</strong> between Spaces. It enforces Agreement-governed security, privacy, and protocol consistency through layered envelopes that correspond to membrane validation gates.</p>
<p>Trust Channels:</p>
<ul>
<li>Exist <strong>only</strong> in the Rust runtime; the TypeScript SDK never hosts a Trust Channel.</li>
<li>Are always governed by an <strong>Agreement</strong>, which defines envelope sequencing, crypto and policy parameters.</li>
<li>Dynamically select compatible <strong>ProtocolSuites</strong> through <strong>Protocol Negotiation</strong> during capsule formation.</li>
<li>Trigger the transport and validation mechanism for all cross-Space Dances.</li>
</ul>
<p>The TypeScript↔Rust interface inside a single Tauri process is <em>not</em> a membrane boundary and therefore bypasses Trust Channel logic.</p>
<hr />
<h2 id="1-deployment-architecture">1. Deployment Architecture<a class="headerlink" href="#1-deployment-architecture" title="Permanent link">&para;</a></h2>
<h3 id="11-system-topology-overview">1.1 System Topology Overview<a class="headerlink" href="#11-system-topology-overview" title="Permanent link">&para;</a></h3>
<p>Each <strong>Agent</strong> in MAP operates within an <strong>Agreement Space</strong>—a membrane enclosing Agents that share at least one Agreement.<br />
Agents are depicted as spheres connected by a <strong>mycelial web</strong> of Trust Channels representing the live peer-to-peer fabric.</p>
<ul>
<li><strong>Source Container:</strong> Rust runtime of the sending Agent (Space A).</li>
<li><strong>Destination Container:</strong> Rust runtime of the receiving Agent (Space B).</li>
<li><strong>Trust Channel:</strong> logical and cryptographic conduit linking both membranes.</li>
<li><strong>Transport Protocol:</strong> the routing mechanism defined by the Agreement (e.g., DHT gossip, relay, or direct peer link).</li>
</ul>
<p>When a <strong>DanceRequest</strong> leaves an Agent’s pore, it travels through the Trust Channel across the mycelial web, wrapped in layers of envelopes that perform sequential validation.<br />
At the receiving pore, the Trust Channel unwraps these envelopes inward, validating routing, signature, encryption, authorization, and dispatch.<br />
A <strong>DanceResponse</strong> is then re-encapsulated with outbound envelopes in reverse order and sent back through the same path.</p>
<h3 id="12-trust-channel-cross-section">1.2 Trust Channel Cross-Section<a class="headerlink" href="#12-trust-channel-cross-section" title="Permanent link">&para;</a></h3>
<p>Each Trust Channel is visualized as a <strong>funnel</strong> through the agent’s membrane.<br />
Envelopes are represented as <strong>gates</strong>, initially closed.<br />
As validation succeeds layer by layer, each gate opens and the remaining inner capsule drops through to the next gate until only the inner <strong>Dance</strong> remains.<br />
Outbound responses travel upward through the same funnel, having their envelopes reapplied and gates resealed.</p>
<hr />
<h2 id="2-core-concepts">2. Core Concepts<a class="headerlink" href="#2-core-concepts" title="Permanent link">&para;</a></h2>
<h3 id="21-dance-capsule">2.1 Dance Capsule<a class="headerlink" href="#21-dance-capsule" title="Permanent link">&para;</a></h3>
<p>A <strong>Dance Capsule</strong> is a holarchic structure of nested <strong>Envelope</strong> holons surrounding a <code>Dance</code> (request or response).<br />
Each envelope performs one membrane function: routing, authentication, encryption, authorization, dispatch, or filtering.<br />
Inbound sequence:<br />
<code>Transport → AuthN → Crypto → AuthZ → Dispatch → Payload</code><br />
Outbound sequence:<br />
<code>Payload → Exfiltration → Crypto → AuthN → Transport</code></p>
<p>Each layer exposes progressively unwrapped content to the next validation phase.</p>
<h3 id="22-agreement-and-protocolsuite">2.2 Agreement and ProtocolSuite<a class="headerlink" href="#22-agreement-and-protocolsuite" title="Permanent link">&para;</a></h3>
<p>Each Trust Channel is governed by an <strong>Agreement</strong>, which specifies:
- Allowed <strong>ProtocolSuites</strong> (possible envelope sequences and crypto stacks).
- Mappings between Dances and suites via <code>DancePolicyMap</code>.
- Cryptographic and policy relationships (AuthZPolicy, CryptoPolicy, ExfiltrationPolicy, StepUpPolicy).</p>
<p>A <strong>ProtocolSuite</strong> holon defines:
- The ordered envelope sequences for inbound and outbound directions.
- The validator modules for each envelope kind.
- Optional <code>CanDownshiftTo</code> relationships for fallback negotiation.</p>
<h3 id="23-protocol-negotiation">2.3 Protocol Negotiation<a class="headerlink" href="#23-protocol-negotiation" title="Permanent link">&para;</a></h3>
<p>Protocol negotiation determines which <strong>ProtocolSuite</strong> governs a given capsule exchange.<br />
It occurs when a sender proposes a suite under the governing Agreement and the receiver accepts or downshifts to another allowed suite.</p>
<p><strong>Negotiation Steps</strong>
1. <strong>Proposal</strong> — Sender selects a candidate suite from the Agreement’s <code>DancePolicyMap</code> or its <code>DefaultSuite</code> and records it as <code>ProposesSuite</code> in the outer TransportEnvelope.
2. <strong>Validation</strong> — Receiver checks the Agreement’s <code>AllowedProtocolSuites</code>. If the proposal is not permitted, it selects a compatible suite from the sender’s <code>CanDownshiftTo</code> list.
3. <strong>Response</strong> — Receiver records the final choice as <code>AcceptedSuite</code> in the TransportEnvelope.
4. <strong>Pinning</strong> — The capsule pins <code>PinnedAgreement → Agreement</code> and <code>NegotiatedSuite → ProtocolSuite</code>.
5. <strong>Verification</strong> — Upon receipt, validators confirm that the capsule’s suite matches the pinned Agreement and any downshift path was explicitly allowed.</p>
<p>Example:
<div class="highlight"><pre><span></span><code>TransportEnvelope
 ├── ForAgreement → #agr:std
 ├── ProposesSuite → #suite:std-full
 └── AcceptedSuite → #suite:light-authz
</code></pre></div></p>
<hr />
<h2 id="3-envelope-layer-reference-expanded">3. Envelope Layer Reference (Expanded)<a class="headerlink" href="#3-envelope-layer-reference-expanded" title="Permanent link">&para;</a></h2>
<p><em>(Each layer acts as a gate in the membrane funnel.)</em></p>
<hr />
<h3 id="31-transport-envelope">3.1 Transport Envelope<a class="headerlink" href="#31-transport-envelope" title="Permanent link">&para;</a></h3>
<p><strong>Summary:</strong> The outermost envelope governing routing, Agreement pinning, and protocol negotiation.</p>
<h4 id="conceptual-purpose">Conceptual Purpose<a class="headerlink" href="#conceptual-purpose" title="Permanent link">&para;</a></h4>
<p>The <strong>TransportEnvelope</strong> establishes the routing and trust context for the capsule. It ensures that the message travels only between agents authorized by the governing Agreement and that both peers agree on the ProtocolSuite governing this exchange.</p>
<h4 id="holon-type-and-relationships">Holon Type and Relationships<a class="headerlink" href="#holon-type-and-relationships" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>HolonType: TransportEnvelope
Relationships:
  Wraps → AuthNEnvelope
  ForAgreement → Agreement
  ProposesSuite → ProtocolSuite?
  AcceptedSuite → ProtocolSuite
  SenderAgent → Agent
  RecipientAgent → Agent
</code></pre></div>
<h4 id="key-data-fields">Key Data Fields<a class="headerlink" href="#key-data-fields" title="Permanent link">&para;</a></h4>
<ul>
<li><code>sender_id</code>: Agent identifier of initiator</li>
<li><code>recipient_id</code>: target Agent identifier</li>
<li><code>agreement_ref</code>: reference to Agreement ID and version hash</li>
<li><code>transport_protocol</code>: protocol to be used (DHT, relay, direct)</li>
<li><code>timestamp</code>: for replay detection</li>
<li><code>routing_signature</code>: optional checksum or route proof</li>
</ul>
<h4 id="processing-steps">Processing Steps<a class="headerlink" href="#processing-steps" title="Permanent link">&para;</a></h4>
<p><strong>Build:</strong>
1. Fetch Agreement metadata; confirm peer is an authorized participant.
2. Select candidate <code>ProtocolSuite</code> and record as <code>ProposesSuite</code>.
3. Compute and store routing metadata and Agreement hash.
4. Attach the next envelope as payload.</p>
<p><strong>Validate:</strong>
1. Verify Agreement hash matches local record.
2. Check recipient field corresponds to the local Agent.
3. Confirm <code>AcceptedSuite</code> belongs to Agreement’s allowed suites.
4. Resolve routing path via Agreement transport settings.</p>
<h4 id="expected-outcome">Expected Outcome<a class="headerlink" href="#expected-outcome" title="Permanent link">&para;</a></h4>
<p>Validated routing context and pinned Agreement; the capsule is confirmed to have arrived at the correct membrane pore under the proper governance framework.</p>
<h4 id="developer-guidance">Developer Guidance<a class="headerlink" href="#developer-guidance" title="Permanent link">&para;</a></h4>
<p>Rust developers should implement this as the first validator in the inbound pipeline. TransportEnvelope validation failures typically indicate misrouting or incompatible Agreements.</p>
<hr />
<h3 id="32-authentication-envelope-authn">3.2 Authentication Envelope (AuthN)<a class="headerlink" href="#32-authentication-envelope-authn" title="Permanent link">&para;</a></h3>
<p><strong>Summary:</strong> Establishes the authenticity and integrity of the capsule.</p>
<h4 id="conceptual-purpose_1">Conceptual Purpose<a class="headerlink" href="#conceptual-purpose_1" title="Permanent link">&para;</a></h4>
<p>The <strong>AuthNEnvelope</strong> confirms that the message was genuinely sent by an authorized participant and that its contents have not been modified since transmission.</p>
<h4 id="holon-type-and-relationships_1">Holon Type and Relationships<a class="headerlink" href="#holon-type-and-relationships_1" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>HolonType: AuthNEnvelope
Relationships:
  Wraps → CryptoEnvelope
  SignerAgent → Agent
  UsesCryptoPolicy → CryptoPolicy
</code></pre></div>
<h4 id="key-data-fields_1">Key Data Fields<a class="headerlink" href="#key-data-fields_1" title="Permanent link">&para;</a></h4>
<ul>
<li><code>signature_scheme</code>: algorithm identifier (e.g., Ed25519)</li>
<li><code>signature</code>: base64 signature of inner envelope hash</li>
<li><code>signer_public_key_ref</code>: pointer to sender’s public key within Agreement</li>
<li><code>signed_hash</code>: computed SHA-256 or BLAKE3 digest</li>
</ul>
<h4 id="processing-steps_1">Processing Steps<a class="headerlink" href="#processing-steps_1" title="Permanent link">&para;</a></h4>
<p><strong>Build:</strong>
1. Serialize the inner envelope and compute hash.
2. Sign the hash using the sender’s private key via Lair.
3. Attach signature and metadata.</p>
<p><strong>Validate:</strong>
1. Retrieve sender’s public key from Agreement.
2. Recompute hash of the inner envelope.
3. Verify signature using declared algorithm.
4. Log outcome to telemetry for risk analysis.</p>
<h4 id="expected-outcome_1">Expected Outcome<a class="headerlink" href="#expected-outcome_1" title="Permanent link">&para;</a></h4>
<p>Message integrity and sender authenticity confirmed. If verification fails, the capsule is discarded.</p>
<h4 id="developer-guidance_1">Developer Guidance<a class="headerlink" href="#developer-guidance_1" title="Permanent link">&para;</a></h4>
<p>Use the <code>ring</code> or <code>ed25519_dalek</code> crates for signing/verification; keys must always be accessed through Lair interfaces. Avoid holding private keys in process memory longer than necessary.</p>
<hr />
<h3 id="33-cryptography-envelope-crypto">3.3 Cryptography Envelope (Crypto)<a class="headerlink" href="#33-cryptography-envelope-crypto" title="Permanent link">&para;</a></h3>
<p><strong>Summary:</strong> Provides confidentiality by encrypting the inner payload.</p>
<h4 id="conceptual-purpose_2">Conceptual Purpose<a class="headerlink" href="#conceptual-purpose_2" title="Permanent link">&para;</a></h4>
<p>The <strong>CryptoEnvelope</strong> ensures that only the intended recipient can read the inner payload. It also provides tamper protection and payload freshness via nonces.</p>
<h4 id="holon-type-and-relationships_2">Holon Type and Relationships<a class="headerlink" href="#holon-type-and-relationships_2" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>HolonType: CryptoEnvelope
Relationships:
  Wraps → AuthZEnvelope
  RecipientAgent → Agent
  UsesCryptoPolicy → CryptoPolicy
</code></pre></div>
<h4 id="key-data-fields_2">Key Data Fields<a class="headerlink" href="#key-data-fields_2" title="Permanent link">&para;</a></h4>
<ul>
<li><code>cipher_suite</code>: e.g., XChaCha20-Poly1305</li>
<li><code>nonce</code>: unique per message</li>
<li><code>encrypted_payload</code>: ciphertext of next envelope</li>
<li><code>key_ref</code>: recipient public key or shared secret identifier</li>
</ul>
<h4 id="processing-steps_2">Processing Steps<a class="headerlink" href="#processing-steps_2" title="Permanent link">&para;</a></h4>
<p><strong>Build:</strong>
1. Serialize inner envelope.
2. Generate random nonce.
3. Encrypt payload with recipient’s public key or derived shared secret.
4. Attach cipher suite metadata.</p>
<p><strong>Validate:</strong>
1. Fetch recipient private key from Lair.
2. Decrypt payload using declared cipher suite.
3. Verify authentication tag integrity.
4. Replace ciphertext with plaintext inner envelope.</p>
<h4 id="expected-outcome_2">Expected Outcome<a class="headerlink" href="#expected-outcome_2" title="Permanent link">&para;</a></h4>
<p>Payload decrypted successfully; the next layer is now readable only by authorized recipient.</p>
<h4 id="developer-guidance_2">Developer Guidance<a class="headerlink" href="#developer-guidance_2" title="Permanent link">&para;</a></h4>
<p>Follow the crypto policy declared in Agreement. Ensure nonce uniqueness per sender-recipient-session to prevent replay attacks.</p>
<hr />
<h3 id="34-authorization-envelope-authz">3.4 Authorization Envelope (AuthZ)<a class="headerlink" href="#34-authorization-envelope-authz" title="Permanent link">&para;</a></h3>
<p><strong>Summary:</strong> Enforces role- and scope-based permission checks.</p>
<h4 id="conceptual-purpose_3">Conceptual Purpose<a class="headerlink" href="#conceptual-purpose_3" title="Permanent link">&para;</a></h4>
<p>The <strong>AuthZEnvelope</strong> ensures the request is permitted under the Agreement’s role, scope, and timing rules. It acts as a programmable contract verifying that the sender’s authority matches the Dance being requested.</p>
<h4 id="holon-type-and-relationships_3">Holon Type and Relationships<a class="headerlink" href="#holon-type-and-relationships_3" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>HolonType: AuthZEnvelope
Relationships:
  Wraps → DispatchEnvelope
  ForAgreement → Agreement
  EvaluatedBy → AuthZPolicy
</code></pre></div>
<h4 id="key-data-fields_3">Key Data Fields<a class="headerlink" href="#key-data-fields_3" title="Permanent link">&para;</a></h4>
<ul>
<li><code>role</code>: sender’s role within Agreement</li>
<li><code>scope</code>: access scope or resource domain</li>
<li><code>policy_tag</code>: identifier for specific AuthZPolicy</li>
<li><code>valid_from</code> / <code>valid_until</code>: temporal constraints</li>
<li><code>policy_signature</code>: optional policy binding proof</li>
</ul>
<h4 id="processing-steps_3">Processing Steps<a class="headerlink" href="#processing-steps_3" title="Permanent link">&para;</a></h4>
<p><strong>Build:</strong>
1. Query Agreement for sender’s role and applicable AuthZPolicy.
2. Embed policy tag and validity window.
3. Sign policy tag if required.</p>
<p><strong>Validate:</strong>
1. Fetch AuthZPolicy from Agreement.
2. Evaluate role-scope alignment against requested Dance.
3. Check time window validity.
4. Verify policy signature if provided.</p>
<h4 id="expected-outcome_3">Expected Outcome<a class="headerlink" href="#expected-outcome_3" title="Permanent link">&para;</a></h4>
<p>Authorization confirmed. Capsule can proceed to dispatch. If denied, validation stops with <code>HolonError::UnauthorizedRole</code>.</p>
<h4 id="developer-guidance_3">Developer Guidance<a class="headerlink" href="#developer-guidance_3" title="Permanent link">&para;</a></h4>
<p>The AuthZ layer is where governance logic is enforced. Ensure policies are declarative holons so they can evolve without code changes.</p>
<hr />
<h3 id="35-dispatch-envelope">3.5 Dispatch Envelope<a class="headerlink" href="#35-dispatch-envelope" title="Permanent link">&para;</a></h3>
<p><strong>Summary:</strong> Controls membrane handoff to local execution.</p>
<h4 id="conceptual-purpose_4">Conceptual Purpose<a class="headerlink" href="#conceptual-purpose_4" title="Permanent link">&para;</a></h4>
<p>The <strong>DispatchEnvelope</strong> represents the moment a capsule transitions from inter-Space validation into intra-Space execution. It validates the target I-Space, ensures that the Dance type is known locally, and checks that any declared target matches an available handler.</p>
<h4 id="holon-type-and-relationships_4">Holon Type and Relationships<a class="headerlink" href="#holon-type-and-relationships_4" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>HolonType: DispatchEnvelope
Relationships:
  Wraps → PayloadEnvelope
  TargetSpace → Space
</code></pre></div>
<h4 id="key-data-fields_4">Key Data Fields<a class="headerlink" href="#key-data-fields_4" title="Permanent link">&para;</a></h4>
<ul>
<li><code>target_space</code>: identifier of destination I-Space or subcontext</li>
<li><code>execution_context</code>: optional environment variables</li>
<li><code>dispatch_signature</code>: integrity hash of routing parameters</li>
</ul>
<h4 id="processing-steps_4">Processing Steps<a class="headerlink" href="#processing-steps_4" title="Permanent link">&para;</a></h4>
<p><strong>Build:</strong>
1. Determine target I-Space based on Agreement routing.
2. Compute dispatch hash.
3. Attach as header to envelope.</p>
<p><strong>Validate:</strong>
1. Confirm that <code>target_space</code> matches local identifier.
2. Check that Dance type exists and is callable.
3. Log dispatch acceptance event.</p>
<h4 id="expected-outcome_4">Expected Outcome<a class="headerlink" href="#expected-outcome_4" title="Permanent link">&para;</a></h4>
<p>Local execution context prepared; control passed to Choreographer.</p>
<h4 id="developer-guidance_4">Developer Guidance<a class="headerlink" href="#developer-guidance_4" title="Permanent link">&para;</a></h4>
<p>Implement DispatchEnvelope validation as the final gate before local code execution. Validation failures should never trigger automatic retries.</p>
<hr />
<h3 id="36-payload-envelope">3.6 Payload Envelope<a class="headerlink" href="#36-payload-envelope" title="Permanent link">&para;</a></h3>
<p><strong>Summary:</strong> Contains the actual DanceRequest or DanceResponse.</p>
<h4 id="conceptual-purpose_5">Conceptual Purpose<a class="headerlink" href="#conceptual-purpose_5" title="Permanent link">&para;</a></h4>
<p>The <strong>PayloadEnvelope</strong> is the innermost layer, containing the semantic content of the interaction. At this point all membrane gates have been cleared.</p>
<h4 id="holon-type-and-relationships_5">Holon Type and Relationships<a class="headerlink" href="#holon-type-and-relationships_5" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>HolonType: PayloadEnvelope
Relationships:
  HasPayloadDance → Dance
</code></pre></div>
<h4 id="key-data-fields_5">Key Data Fields<a class="headerlink" href="#key-data-fields_5" title="Permanent link">&para;</a></h4>
<ul>
<li><code>payload_type</code>: Request or Response</li>
<li><code>payload_model</code>: descriptor name</li>
<li><code>payload_digest</code>: hash for integrity</li>
<li><code>content_encoding</code>: optional compression scheme</li>
</ul>
<h4 id="processing-steps_5">Processing Steps<a class="headerlink" href="#processing-steps_5" title="Permanent link">&para;</a></h4>
<p><strong>Build:</strong>
1. Serialize Dance into canonical format.
2. Compute payload hash.
3. Embed descriptor metadata.</p>
<p><strong>Validate:</strong>
1. Verify hash matches payload content.
2. Deserialize Dance into model.
3. Pass to Choreographer.</p>
<h4 id="expected-outcome_5">Expected Outcome<a class="headerlink" href="#expected-outcome_5" title="Permanent link">&para;</a></h4>
<p>Validated and deserialized Dance ready for execution.</p>
<h4 id="developer-guidance_5">Developer Guidance<a class="headerlink" href="#developer-guidance_5" title="Permanent link">&para;</a></h4>
<p>This envelope rarely fails validation except for integrity mismatches. Any schema errors should be handled by the Choreographer.</p>
<hr />
<h3 id="37-exfiltration-envelope-outbound">3.7 Exfiltration Envelope (Outbound)<a class="headerlink" href="#37-exfiltration-envelope-outbound" title="Permanent link">&para;</a></h3>
<p><strong>Summary:</strong> Filters outbound data per Agreement’s ExfiltrationPolicy.</p>
<h4 id="conceptual-purpose_6">Conceptual Purpose<a class="headerlink" href="#conceptual-purpose_6" title="Permanent link">&para;</a></h4>
<p>The <strong>ExfiltrationEnvelope</strong> ensures that responses leaving a Space comply with that Space’s data sharing rules. It enforces outbound privacy and ensures that only agreed-upon data crosses the membrane.</p>
<h4 id="holon-type-and-relationships_6">Holon Type and Relationships<a class="headerlink" href="#holon-type-and-relationships_6" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>HolonType: ExfiltrationEnvelope
Relationships:
  Wraps → CryptoEnvelope
  AppliesPolicy → ExfiltrationPolicy
</code></pre></div>
<h4 id="key-data-fields_6">Key Data Fields<a class="headerlink" href="#key-data-fields_6" title="Permanent link">&para;</a></h4>
<ul>
<li><code>policy_tag</code>: identifier of applied ExfiltrationPolicy</li>
<li><code>allowed_fields</code>: whitelist of fields</li>
<li><code>thresholds</code>: quantitative limits (e.g., max records)</li>
<li><code>sanitization_map</code>: redaction rules</li>
</ul>
<h4 id="processing-steps_6">Processing Steps<a class="headerlink" href="#processing-steps_6" title="Permanent link">&para;</a></h4>
<p><strong>Build:</strong>
1. Retrieve ExfiltrationPolicy from Agreement.
2. Filter or redact prohibited fields.
3. Record policy tag and transformation metadata.</p>
<p><strong>Validate:</strong>
1. Confirm policy tag exists and matches Agreement.
2. Verify filtered payload complies with declared thresholds.
3. Hash sanitized payload for audit.</p>
<h4 id="expected-outcome_6">Expected Outcome<a class="headerlink" href="#expected-outcome_6" title="Permanent link">&para;</a></h4>
<p>Outbound data sanitized, ready for encryption.</p>
<h4 id="developer-guidance_6">Developer Guidance<a class="headerlink" href="#developer-guidance_6" title="Permanent link">&para;</a></h4>
<p>Developers must implement serialization filters at this layer. Avoid policy logic in business code; always reference ExfiltrationPolicy holons.</p>
<hr />
<h3 id="38-unlock-envelope-optional">3.8 Unlock Envelope (Optional)<a class="headerlink" href="#38-unlock-envelope-optional" title="Permanent link">&para;</a></h3>
<p><strong>Summary:</strong> Captures Second-Factor Session (SFS) verification for sensitive Dances.</p>
<h4 id="conceptual-purpose_7">Conceptual Purpose<a class="headerlink" href="#conceptual-purpose_7" title="Permanent link">&para;</a></h4>
<p>The <strong>UnlockEnvelope</strong> adds human-level verification to the cryptographic stack. It confirms that the user controlling the device has recently authenticated through a configured second factor before performing sensitive or high-risk operations.</p>
<h4 id="holon-type-and-relationships_7">Holon Type and Relationships<a class="headerlink" href="#holon-type-and-relationships_7" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>HolonType: UnlockEnvelope
Relationships:
  Wraps → NextEnvelope
  VerifiedBy → StepUpPolicy
  SessionBelongsTo → Agent
</code></pre></div>
<h4 id="key-data-fields_7">Key Data Fields<a class="headerlink" href="#key-data-fields_7" title="Permanent link">&para;</a></h4>
<ul>
<li><code>session_id</code>: UUID of SFS</li>
<li><code>verified_method</code>: biometric | PIN | hardware_key</li>
<li><code>expires_at</code>: timestamp</li>
<li><code>issued_at</code>: timestamp</li>
</ul>
<h4 id="processing-steps_7">Processing Steps<a class="headerlink" href="#processing-steps_7" title="Permanent link">&para;</a></h4>
<p><strong>Build:</strong>
1. Verify an active SFS exists for this Agent.
2. Record method and expiry.
3. Link to StepUpPolicy.</p>
<p><strong>Validate:</strong>
1. Fetch SFS from secure store.
2. Check TTL and idle timeout.
3. Confirm cryptographic binding to Agent ID.</p>
<h4 id="expected-outcome_7">Expected Outcome<a class="headerlink" href="#expected-outcome_7" title="Permanent link">&para;</a></h4>
<p>Step-up authentication confirmed; the Dance may proceed.</p>
<h4 id="developer-guidance_7">Developer Guidance<a class="headerlink" href="#developer-guidance_7" title="Permanent link">&para;</a></h4>
<p>UnlockEnvelope creation and validation should integrate with the device OS authentication APIs. Never store SFS secrets in application memory.</p>
<hr />
<h3 id="39-sessionstate-envelope-optional">3.9 SessionState Envelope (Optional)<a class="headerlink" href="#39-sessionstate-envelope-optional" title="Permanent link">&para;</a></h3>
<p><strong>Summary:</strong> Transports transient holon state for stateless executions.</p>
<h4 id="conceptual-purpose_8">Conceptual Purpose<a class="headerlink" href="#conceptual-purpose_8" title="Permanent link">&para;</a></h4>
<p>The <strong>SessionStateEnvelope</strong> allows stateful workflows to execute in stateless environments by serializing necessary transient holons and relationship references. It ensures the guest process has enough context to continue processing without permanent data leakage.</p>
<h4 id="holon-type-and-relationships_8">Holon Type and Relationships<a class="headerlink" href="#holon-type-and-relationships_8" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>HolonType: SessionStateEnvelope
Relationships:
  Wraps → PayloadEnvelope
  CarriesState → [TransientHolonPool, NurseryRefs]
</code></pre></div>
<h4 id="key-data-fields_8">Key Data Fields<a class="headerlink" href="#key-data-fields_8" title="Permanent link">&para;</a></h4>
<ul>
<li><code>state_hash</code>: integrity checksum</li>
<li><code>state_length</code>: size in bytes</li>
<li><code>allowed_types</code>: whitelist of permitted transient types</li>
</ul>
<h4 id="processing-steps_8">Processing Steps<a class="headerlink" href="#processing-steps_8" title="Permanent link">&para;</a></h4>
<p><strong>Build:</strong>
1. Serialize transient pool and nursery references.
2. Compute hash and record metadata.
3. Attach to next envelope.</p>
<p><strong>Validate:</strong>
1. Verify hash integrity.
2. Deserialize transient pool.
3. Enforce allowed_types filter.</p>
<h4 id="expected-outcome_8">Expected Outcome<a class="headerlink" href="#expected-outcome_8" title="Permanent link">&para;</a></h4>
<p>State hydrated in recipient’s transient context; execution can proceed seamlessly.</p>
<h4 id="developer-guidance_8">Developer Guidance<a class="headerlink" href="#developer-guidance_8" title="Permanent link">&para;</a></h4>
<p>Keep transient pools small. This mechanism is not intended for bulk data transfer. Always validate deserialized objects before use.</p>
<hr />
<h2 id="4-lifecycle-overview">4. Lifecycle Overview<a class="headerlink" href="#4-lifecycle-overview" title="Permanent link">&para;</a></h2>
<ol>
<li><strong>Outbound Request:</strong> Select suite, negotiate, build, transmit.</li>
<li><strong>Inbound Validation:</strong> Validate sequentially (Transport→AuthN→Crypto→AuthZ→Dispatch→Payload).</li>
<li><strong>Response:</strong> Apply outbound envelopes in reverse order and send back.</li>
</ol>
<hr />
<h2 id="5-error-handling">5. Error Handling<a class="headerlink" href="#5-error-handling" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Error</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>InvalidAgreementRef</code></td>
<td>Agreement hash mismatch.</td>
</tr>
<tr>
<td><code>ProtocolSuiteMismatch</code></td>
<td>Suite not permitted.</td>
</tr>
<tr>
<td><code>InvalidProtocolProposal</code></td>
<td>Proposed suite invalid.</td>
</tr>
<tr>
<td><code>SuiteDownshiftNotPermitted</code></td>
<td>Unauthorized fallback.</td>
</tr>
<tr>
<td><code>SignatureInvalid</code></td>
<td>AuthN failure.</td>
</tr>
<tr>
<td><code>DecryptionFailed</code></td>
<td>Crypto validation failed.</td>
</tr>
<tr>
<td><code>UnauthorizedRole</code></td>
<td>AuthZ check failed.</td>
</tr>
<tr>
<td><code>DispatchDenied</code></td>
<td>Target invalid.</td>
</tr>
<tr>
<td><code>ExfiltrationDenied</code></td>
<td>Policy violation.</td>
</tr>
<tr>
<td><code>RequiresSecondFactor</code></td>
<td>Missing SFS.</td>
</tr>
<tr>
<td><code>SessionStateUnavailable</code></td>
<td>Missing transient data.</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="6-implementation-notes">6. Implementation Notes<a class="headerlink" href="#6-implementation-notes" title="Permanent link">&para;</a></h2>
<ul>
<li>All envelopes and policies are holons declared in the Meta-Schema.</li>
<li>Validators and builders are modular and referenced dynamically via descriptors.</li>
<li>Use Lair for all key operations; private keys never exposed.</li>
<li>Emit telemetry for every validation result to support audit and behavioral analysis.</li>
<li>Agreements may define multiple suites per sensitivity tier for flexible negotiation.</li>
</ul>
<hr />
<h2 id="7-summary">7. Summary<a class="headerlink" href="#7-summary" title="Permanent link">&para;</a></h2>
<p>The Trust Channel provides a <strong>layered, Agreement-driven security framework</strong> for all cross-Space communications.<br />
Each envelope serves a distinct purpose, from routing and authentication to encryption, authorization, dispatch, and outbound filtering.<br />
Protocol negotiation guarantees interoperability, while each validation gate enforces sovereignty and trust.<br />
This layered architecture transforms MAP’s peer-to-peer network into a <strong>self-verifying, self-governing fabric</strong> for secure inter-Space collaboration.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../capsulization/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Capsulization Strategy">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Capsulization Strategy
              </div>
            </div>
          </a>
        
        
          
          <a href="../holon-data-loader-design-spec/" class="md-footer__link md-footer__link--next" aria-label="Next: Holon Loader Spec">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Holon Loader Spec
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "search.highlight", "navigation.top", "navigation.footer", "content.action.edit"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>