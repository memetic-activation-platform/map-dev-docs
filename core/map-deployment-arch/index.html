
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../mapp-dev/trust-channel/">
      
      
        <link rel="next" href="../map-type-system-revised/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.11">
    
    
      
        <title>Deployment Architecture - MAP Developer Docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="cyan">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#map-rust-api-developer-guide" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="MAP Developer Docs" class="md-header__button md-logo" aria-label="MAP Developer Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            MAP Developer Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Deployment Architecture
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="cyan"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="cyan"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="MAP Developer Docs" class="md-nav__button md-logo" aria-label="MAP Developer Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    MAP Developer Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Mapp Developers
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Mapp Developers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mapp-dev/rust-api-developers-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Developers Guide to the MAP Rust-API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mapp-dev/holon-data-loader-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Holon Data Loader Guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mapp-dev/holon-loader-man-page/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Holon Data Loader CLI Man Page
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mapp-dev/tags_to_memes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tags to Memes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mapp-dev/extensibility-model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    The MAP Extensibility Model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mapp-dev/trust-channel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Trust Channels
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../map-content-distribution-arch.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    A Sovereign Content Distribution Architecture
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Visualizer Developers
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    MAP Core
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            MAP Core
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Deployment Architecture
    
  </span>
  

      </a>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../map-type-system-revised/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MAP Type System
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../transaction-model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MAP Transaction Model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../on-boarding/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    On-Boarding Flow
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dances-design/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dances Design Spec
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../capsulization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Capsulization Strategy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../trust-channel-design-spec/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Trust Channel Design Spec
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../holon-data-loader-design-spec/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Holon Loader Spec
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../meta-value-types-import-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Meta-Value Import Guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../i18n-design-spec/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Internationalization Design Spec
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../wasm-crate-guidelines/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Workspace Structure and WASM Guidelines
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Shared Concepts
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../shared/glossary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Glossary
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="map-rust-api-developer-guide">MAP Rust-API Developer Guide<a class="headerlink" href="#map-rust-api-developer-guide" title="Permanent link">&para;</a></h1>
<p>The <strong>Rust-API</strong> is the boundary between your application code and the underlying holon store and services. It provides:</p>
<ul>
<li><strong>Uniform handles (“references”) to holons</strong>, regardless of whether they are transient, staged, or cached/saved.</li>
<li>A <strong>small, consistent read/write API</strong> that hides internal manager and phase differences.</li>
<li>High-level <strong>operations</strong> for staging, committing, and deleting.</li>
<li>A <strong>curated prelude</strong> for ergonomic imports and a stable public API.</li>
</ul>
<p>This guide explains the API surface and shows how to perform the most common tasks.</p>
<hr />
<h1 id="part-i-foundations">Part I – Foundations<a class="headerlink" href="#part-i-foundations" title="Permanent link">&para;</a></h1>
<h2 id="1-prelude">1. Prelude<a class="headerlink" href="#1-prelude" title="Permanent link">&para;</a></h2>
<p>To simplify imports, use the MAP prelude:</p>
<p>```rust,ignore
use holons_prelude::prelude::*;
<div class="highlight"><pre><span></span><code>This brings into scope:

* Core value and identifier types (`BaseValue`, `MapString`, `HolonId`)
* Reference traits and types (`HolonReference`, `ReadableHolon`, `WritableHolon`, `TransientReference`, `StagedReference`, `SmartReference`)
* Context traits (`HolonsContextBehavior`)
* Common operations (`stage_new_holon_api`, `commit_api`, etc.)
* Type-name helpers (`CorePropertyTypeName`, `CoreRelationshipTypeName`, `ToPropertyName`, `ToRelationshipName`)
* Dance protocol builders (`holon_dance_builders::*`)
* Query types (`Node`, `NodeCollection`, `QueryExpression`)

&gt; Use `holons_prelude::prelude::v1::*` if you need to pin to a stable prelude version.

---

## 2. Context: your execution environment

Every holon operation in MAP runs within a **context** that implements the `HolonsContextBehavior` trait. This context is the execution environment for all read, write, and commit actions—it provides access to the active workspace where your holons live.

As a developer, you don’t create or manage the context yourself. Your mApp receives it from the runtime whenever you perform operations that touch holons.  
You simply pass it along to each API call that needs it.

Example — staging and committing a holon:

```rust,no_run
use holons_prelude::prelude::*;

fn create_and_commit(
    context: &amp;dyn HolonsContextBehavior,
) -&gt; Result&lt;(), HolonError&gt; {
    // Create a new transient holon of a given type
    let transient = new_holon(context, MapString(&quot;ExampleType&quot;.into()));
    transient.with_property_value(context, P::Key, &quot;example-1&quot;.into())?;

    // Stage it for persistence
    let _staged = stage_new_holon_api(context, transient)?;

    // Commit all staged changes
    let response = commit_api(context)?;
    println!(&quot;Committed {} holons.&quot;, response.commits_attempted);

    Ok(())
}
</code></pre></div></p>
<h3 id="key-points-for-developers">Key points for developers<a class="headerlink" href="#key-points-for-developers" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>The <strong>context</strong> is always the first parameter to any read or write call. 
  It carries all the state needed to resolve references, access relationships, and enforce permissions.</p>
</li>
<li>
<p>You can think of it as your “session” or “workspace.”    Everything that happens during a transaction—reads, writes, staging, commits—occurs <em>within</em> this context.</p>
</li>
<li>
<p>The context automatically routes requests to the right implementation based on the holon’s phase (transient, staged, or saved).  You never need to know which storage or cache layer is involved.</p>
</li>
<li>
<p>Contexts are lightweight and short-lived. They are passed around as immutable references (<code>&amp;dyn HolonsContextBehavior</code>), so you can safely use them in async or concurrent flows.</p>
</li>
</ul>
<p>In short: <strong>the context is your gateway to the MAP</strong>. You use it everywhere, but you don’t manage or configure it—just pass it through to the reference-layer API.</p>
<hr />
<h2 id="3-reference-kinds">3. Reference Kinds<a class="headerlink" href="#3-reference-kinds" title="Permanent link">&para;</a></h2>
<p><code>HolonReference</code> is the <strong>universal handle</strong> for accessing any holon in MAP—whether it’s newly created, staged for commit, or already persisted.<br />
It abstracts over three underlying reference types that represent different lifecycle phases of a holon.</p>
<ul>
<li><strong><code>TransientReference</code></strong> — in-memory, mutable, not yet persisted.</li>
<li><strong><code>StagedReference</code></strong> — managed by the staging layer and ready to commit.</li>
<li><strong><code>SmartReference</code></strong> — read-only, backed by a saved holon in cache or storage.</li>
</ul>
<p>All three implement the <code>ReadableHolon</code> trait;<br />
<code>TransientReference</code> and <code>StagedReference</code> additionally implement <code>WritableHolon</code>.</p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Backing store</th>
<th>Read</th>
<th>Write</th>
<th>Commit</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>HolonReference</code></td>
<td>Delegates to underlying phase</td>
<td>✅</td>
<td>✅ / ❌</td>
<td>✅ / ❌</td>
<td>Unified handle that wraps any reference type. Enforces access rules automatically.</td>
</tr>
<tr>
<td><code>TransientReference</code></td>
<td>In-memory</td>
<td>✅</td>
<td>✅</td>
<td>❌</td>
<td>Must be staged before commit.</td>
</tr>
<tr>
<td><code>StagedReference</code></td>
<td>Staging area</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>Prepared for persistence.</td>
</tr>
<tr>
<td><code>SmartReference</code></td>
<td>Saved/cache</td>
<td>✅</td>
<td>❌</td>
<td>❌</td>
<td>Read-only view of a saved holon.</td>
</tr>
</tbody>
</table>
<h3 id="unified-trait-implementation">Unified trait implementation<a class="headerlink" href="#unified-trait-implementation" title="Permanent link">&para;</a></h3>
<p><code>HolonReference</code> implements both <code>ReadableHolon</code> <strong>and</strong> <code>WritableHolon</code>.<br />
This means you can call read or write methods directly on a <code>HolonReference</code> without downcasting to its internal variant.</p>
<p>However, <strong>write access is phase-dependent</strong>:</p>
<ul>
<li>If the reference wraps a <code>TransientReference</code> or <code>StagedReference</code>, write operations (e.g., <code>with_property_value</code>, <code>add_related_holons</code>) will succeed normally.</li>
<li>If the reference wraps a <code>SmartReference</code>, any attempt to modify it will result in<br />
<code>HolonError::NotAccessible</code>.</li>
</ul>
<p>This design provides ergonomic consistency while maintaining strict access guarantees.</p>
<h3 id="typical-usage-pattern">Typical usage pattern<a class="headerlink" href="#typical-usage-pattern" title="Permanent link">&para;</a></h3>
<p>```rust,ignore
// Works regardless of phase
let title = holon_ref.property_value(context, &amp;P::Title)?;</p>
<p>// Safe to call; will fail gracefully if reference is read-only
holon_ref.with_property_value(context, P::Title, "Updated".into())?;
<div class="highlight"><pre><span></span><code>In short:  
**`HolonReference` provides a single, uniform API for all holon phases**, while the combination of context and reference phase determines which operations are actually permitted.

---

# Part II – Holon Operations (HolonOperationsApi)

The **HolonOperationsApi** provides high-level functions for creating, staging, committing, and deleting holons.  It serves as the main entry point for mApp developers who need to persist holons, abstracting away the lower-level service lookups handled by the `HolonSpaceManager`. Where the `ReadableHolon` and `WritableHolon` traits focus on *individual holon content*, the operations in this API focus on *holon lifecycle actions* — such as preparing holons for persistence, committing them to storage, and querying what’s currently staged.

---

## 4. Creating and staging holons

Holons can be created or staged in several ways, depending on the source and intent. All staging operations result in a `StagedReference`, representing a holon managed by the **Nursery** and ready for commit.

### A. Creating a new transient holon

Use `new_holon` to create a new, empty transient holon. Once created, you can use its TransientReference to et its properties or relationships (see `WritableHolon` operations below).

```rust,ignore
let transient = new_holon(context, MapString(&quot;BookType&quot;.into()))?;
transient.with_property_value(context, P::Title, &quot;The Rustonomicon&quot;.into())?;
</code></pre></div></p>
<p>Transient holons are purely in-memory — they can be used ephemerally (e.g., as temporary parameters in a Dance), or later staged for persistence.</p>
<hr />
<h3 id="b-staging-a-new-holon-from-scratch">B. Staging a new holon from scratch<a class="headerlink" href="#b-staging-a-new-holon-from-scratch" title="Permanent link">&para;</a></h3>
<p>To prepare a transient holon for persistence, call <code>stage_new_holon</code>. This registers it in the Nursery and returns a <code>StagedReference</code>.</p>
<p>```rust,ignore
let transient = new_holon(context, MapString("BookType".into()))?;
transient.with_property_value(context, P::Key, "example-1".into())?;</p>
<p>let staged = stage_new_holon(context, transient)?;
<div class="highlight"><pre><span></span><code>The newly staged holon now participates in commit operations and can have relationships or properties safely modified.

---

### C. Staging a holon by cloning another

Use `stage_new_from_clone` to create a new staged holon based on an existing one. The `original_holon` may be a transient, staged, or saved holon.  NOTE: stage_new_from_clone on a Transient HolonReference is equivalent to `stage_new_holon`. To distinguish the new holon from the holon it is being cloned from, pass the &quot;key&quot; for the new holon as a parameter.

```rust,ignore
let staged_clone = stage_new_from_clone(context, existing_ref, MapString(&quot;copy-001&quot;.into()))?;
</code></pre></div></p>
<p>Use this form when you want to <em>derive</em> a new holon from an existing one without creating a lineage relationship.</p>
<hr />
<h3 id="d-staging-a-new-version-of-a-saved-holon">D. Staging a new version of a saved holon<a class="headerlink" href="#d-staging-a-new-version-of-a-saved-holon" title="Permanent link">&para;</a></h3>
<p>Saved holons (accessed via <code>SmartReference</code>) are immutable. To “update” one, you must stage a new holon that explicitly declares the saved holon as its predecessor. This ensures historical lineage and preserves auditability.</p>
<p>```rust,ignore
let staged_version = stage_new_version(context, saved_ref)?;
staged_version.with_property_value(context, P::Status, "Revised".into())?;
<div class="highlight"><pre><span></span><code>&gt; Conceptually, `stage_new_version` is the canonical “update” mechanism in MAP.  
&gt; Instead of mutating data, it creates a new holon with lineage continuity.

---

### Summary of staging options

| Use case                      | Input reference kind | Function               | Result            | Lineage | Notes                                |
|-------------------------------|----------------------|------------------------|-------------------|---------|--------------------------------------|
| Create new holon from scratch | None (new)           | `stage_new_holon`      | `StagedReference` | ❌       | Typical create workflow              |
| Derive holon from another     | Any                  | `stage_new_from_clone` | `StagedReference` | ❌       | Copy data from any source            |
| Create new version (update)   | `SmartReference`     | `stage_new_version`    | `StagedReference` | ✅       | Adds predecessor link for versioning |

All three return `StagedReference`, ready to commit.

---

## 5. Committing staged holons

Once one or more holons have been staged, you can persist them together using `commit`.

```rust,ignore
let response = commit(context)?;
println!(
    &quot;Saved: {}, Abandoned: {}, Attempted: {}&quot;,
    response.saved_holons.len(),
    response.abandoned_holons.len(),
    response.commits_attempted
);
</code></pre></div></p>
<h3 id="commitresponse-contents">CommitResponse contents<a class="headerlink" href="#commitresponse-contents" title="Permanent link">&para;</a></h3>
<ul>
<li><strong><code>saved_holons</code></strong> — list of successfully persisted holons.</li>
<li><strong><code>abandoned_holons</code></strong> — holons that were skipped or invalidated.</li>
<li><strong><code>commits_attempted</code></strong> — total count of staged holons processed.</li>
</ul>
<p>A complete commit satisfies:<br />
<code>(saved + abandoned == attempted)</code></p>
<h3 id="commit-outcomes">Commit outcomes<a class="headerlink" href="#commit-outcomes" title="Permanent link">&para;</a></h3>
<p><strong>Complete Commit</strong> – All staged holons and relationships persisted successfully.<br />
The Nursery is cleared of committed entries.</p>
<p><strong>Partial Commit</strong> – Some holons committed successfully, others remain staged with error details.<br />
No staged holons are automatically removed, allowing retries.</p>
<p><strong>Failure</strong> – System-level issue prevented commit; no changes persisted.</p>
<hr />
<h3 id="e-counting-and-retrieving-staged-holons">E. Counting and retrieving staged holons<a class="headerlink" href="#e-counting-and-retrieving-staged-holons" title="Permanent link">&para;</a></h3>
<p>Helper methods are available for diagnostics or introspection:</p>
<p>```rust,ignore
let staged_total = staged_count(context);
let transient_total = transient_count(context);
println!("Currently staged: {}, transient: {}", staged_total, transient_total);
<div class="highlight"><pre><span></span><code>You can also look up specific holons by key:

```rust,ignore
let staged_by_key = get_staged_holon_by_base_key(context, &amp;MapString(&quot;example-1&quot;.into()))?;
</code></pre></div></p>
<hr />
<h3 id="f-deleting-holons">F. Deleting holons<a class="headerlink" href="#f-deleting-holons" title="Permanent link">&para;</a></h3>
<p>Holons can be deleted via <code>delete_holon</code>, but only local (i.e., space-owned) saved holons may be deleted.</p>
<p>```rust,ignore
delete_holon(context, local_id)?;
<div class="highlight"><pre><span></span><code>Deletion removes the holon from the current holon space and, if invoked from the guest side, from the DHT as well.

---

### Conceptual overview

The **HolonOperationsApi** provides the primary bridge between mApp logic and the MAP storage layer.  
It’s designed for developer clarity and consistency:

* **`new_holon`** → Creates new in-memory holons.
* **`stage_new_*`** → Moves holons into the staging area, ready for commit.
* **`commit`** → Persists all staged holons atomically.
* **`delete_holon`** → Removes holons permanently.

Together, these functions represent the canonical workflow for managing holon persistence.

---

# Part III – Individual Holons (ReadableHolon, WritableHolon)

## 7. Reading holons (ReadableHolon)

Every `HolonReference` implements `ReadableHolon`.  
Reads are *kind-safe* and work consistently across transient, staged, and saved holons.

---

### Core reads

`key(context) -&gt; Option&lt;MapString&gt;`

The human-meaningful identifier for the holon, if defined.  
Some holon kinds are keyless, so this may return `None`.

Example:
```rust,ignore
let key_opt = reference.key(context)?;
</code></pre></div></p>
<hr />
<p><code>versioned_key(context) -&gt; MapString</code></p>
<p>A stable, fully-qualified identifier that includes the base key plus version information (when applicable).<br />
Since saved holons are immutable, updating a saved holon creates a <em>new version</em> with a distinct <code>versioned_key</code>.<br />
If the update doesn’t alter the underlying key properties, the new holon will share the same base key.</p>
<p>Example:
```rust,ignore
let vkey = reference.versioned_key(context)?;
<div class="highlight"><pre><span></span><code>---

`property_value(context, name) -&gt; Option&lt;PropertyValue&gt;`

Reads a property by name using **ergonomic inputs**:  
`&amp;str`, `String`, `MapString`, `PropertyName`, or a core enum such as `CorePropertyTypeName::Title`.  
Returns `None` if the property is absent.

Example:
```rust,ignore
let title_opt = reference.property_value(context, &quot;title&quot;)?;
</code></pre></div></p>
<hr />
<p><code>related_holons(context, name) -&gt; HolonCollection</code></p>
<p>Navigates an outgoing relationship and returns a collection of <code>HolonReference</code>s to the linked holons.<br />
Accepts <code>&amp;str</code>, <code>String</code>, <code>MapString</code>, <code>RelationshipName</code>, or a core enum.<br />
Always returns a <code>HolonCollection</code> (possibly empty), never <code>None</code>.</p>
<p>Example:
```rust,ignore
let children = reference.related_holons(context, "HAS_CHILD")?;
<div class="highlight"><pre><span></span><code>---

### When to use which

| Method               | Purpose                                                                                                        |
|----------------------|----------------------------------------------------------------------------------------------------------------|
| **`key`**            | Retrieve or display a meaningful base key. Use for routing, URLs, and user-facing identifiers.                 |
| **`versioned_key`**  | Generate stable identifiers for logging, caching, and cross-system references.                                 |
| **`property_value`** | Read domain fields (e.g., `title`, `status`). Use ergonomic names: `&quot;title&quot;` or `CorePropertyTypeName::Title`. |
| **`related_holons`** | Traverse graph links (e.g., `&quot;HAS_CHILD&quot;`, `CoreRelationshipTypeName::HasChild`) and iterate results.          |

---

### Ergonomic property and relationship access

MAP’s ergonomic wrapper traits make property and relationship access feel natural:

* **`ToPropertyName`** — allows property lookups using core enums, strings, or `MapString`s.
* **`ToRelationshipName`** — allows relationship lookups using core enums or strings.

These remove the need to manually construct `PropertyName(MapString(...))` or `BaseValue::StringValue(...)` and unify access across core and dynamic names.

#### Examples

**Before (verbose):**
```rust,ignore
let title = reference.property_value(
    context,
    PropertyName(MapString(&quot;title&quot;.into())),
)?;
</code></pre></div></p>
<p><strong>Now (ergonomic):</strong>
```rust,ignore
let title = reference.property_value(context, "title")?;
let author = reference.property_value(context, CorePropertyTypeName::Author)?;
let children = reference.related_holons(context, CoreRelationshipTypeName::HasChild)?;
<div class="highlight"><pre><span></span><code>All inputs are normalized internally (e.g., `&quot;friends&quot;`, `&quot;Friends&quot;`, and `&quot;FRIENDS&quot;` are equivalent).

---

### Example: Reading a property with a default

```rust,ignore
let title = item.property_value(context, &quot;title&quot;)?
    .and_then(|v| v.as_string())
    .unwrap_or_else(|| &quot;Untitled&quot;.to_string());
</code></pre></div></p>
<p>This retrieves the <code>"title"</code> property, converts it to a string if possible, and falls back to <code>"Untitled"</code> when the property is missing or not a string.</p>
<p>Step-by-step:
1. <code>property_value</code> returns a <code>Result&lt;Option&lt;PropertyValue&gt;, HolonError&gt;</code>.<br />
   The <code>?</code> operator unwraps the <code>Result</code>, leaving an <code>Option&lt;PropertyValue&gt;</code>.
2. <code>.and_then(|v| v.as_string())</code> converts the property to a <code>String</code> if it’s string-typed.
3. <code>.unwrap_or_else(|| "Untitled".to_string())</code> substitutes a default when missing.</p>
<p>In plain language:</p>
<blockquote>
<p>“Get the holon’s title if available; otherwise use <code>'Untitled'</code>.”</p>
</blockquote>
<hr />
<h3 id="example-traversing-relationships">Example: Traversing relationships<a class="headerlink" href="#example-traversing-relationships" title="Permanent link">&para;</a></h3>
<p>```rust,ignore
let children = reference.related_holons(context, "HAS_CHILD")?;
for child in children.iter() {
    let ck = child.key(context)?;
    println!("Child key: {:?}", ck);
}
<div class="highlight"><pre><span></span><code>This fetches and iterates through all linked child holons using an ergonomic relationship lookup.

## 8. Writing holons (WritableHolon)

The `WritableHolon` trait provides mutation APIs for holons that can be modified — namely,  
**`TransientReference`** and **`StagedReference`**.  
Attempting to call any of these methods on a `SmartReference` (saved holon) will return  
`HolonError::NotAccessible`.

Writable methods are kind-safe: they automatically update both the in-memory property/relationship maps and any synchronization state used during staging or commit.

---

### Setting property values

`with_property_value(context, name, value) -&gt; Result&lt;(), HolonError&gt;`

Assigns or replaces a property value.  
Accepts property names using ergonomic `ToPropertyName` conversions (e.g., string literals or core enums) and automatically wraps primitive Rust types into their appropriate `PropertyValue`.

Example:
```rust,ignore
reference.with_property_value(context, &quot;title&quot;, &quot;Hello World&quot;)?;
reference.with_property_value(context, CorePropertyTypeName::Status, &quot;Draft&quot;)?;
</code></pre></div></p>
<blockquote>
<p>You can pass Rust primitives such as <code>&amp;str</code>, <code>String</code>, <code>bool</code>, <code>i64</code>, or <code>f64</code>.<br />
Internally these are converted into the appropriate MAP <code>BaseValue</code> variant.</p>
</blockquote>
<hr />
<h3 id="removing-properties">Removing properties<a class="headerlink" href="#removing-properties" title="Permanent link">&para;</a></h3>
<p><code>remove_property_value(context, name) -&gt; Result&lt;(), HolonError&gt;</code></p>
<p>Removes the specified property, if present.</p>
<p>Example:
```rust,ignore
reference.remove_property_value(context, "obsolete")?;
<div class="highlight"><pre><span></span><code>If the property does not exist, the method simply returns `Ok(())`.

---

### Managing relationships

`add_related_holons(context, name, targets) -&gt; Result&lt;(), HolonError&gt;`

Adds one or more related holons under the given relationship name.  
Each target is a `HolonReference`.  
The relationship name accepts the same ergonomic types as property names.

Example:
```rust,ignore
reference.add_related_holons(
    context,
    CoreRelationshipTypeName::HasChild,
    vec![child_ref],
)?;
</code></pre></div></p>
<hr />
<p><code>remove_related_holons(context, name, targets) -&gt; Result&lt;(), HolonError&gt;</code></p>
<p>Removes one or more holons from a relationship set.<br />
Has no effect if the target references are not already related.</p>
<p>Example:
```rust,ignore
reference.remove_related_holons(
    context,
    "HAS_CHILD",
    vec![child_ref],
)?;
<div class="highlight"><pre><span></span><code>&gt; Relationship mutations automatically update the holon’s local relationship map.  
&gt; The changes become durable only after commit.

---

### Setting the descriptor

`with_descriptor(context, descriptor_ref) -&gt; Result&lt;(), HolonError&gt;`

Sets or replaces the holon’s **descriptor**, which declares its type.  
Descriptors are always holons themselves (of a `HolonType` kind).  
This call is uncommon in normal app code — it’s primarily used by loaders or editors creating new holons from schema types.

Example:
```rust,ignore
reference.with_descriptor(context, descriptor_ref)?;
</code></pre></div></p>
<hr />
<h3 id="setting-the-predecessor">Setting the predecessor<a class="headerlink" href="#setting-the-predecessor" title="Permanent link">&para;</a></h3>
<p><code>with_predecessor(context, predecessor_ref) -&gt; Result&lt;(), HolonError&gt;</code></p>
<p>Establishes a lineage relationship between the current holon and its immediate predecessor.<br />
Used mainly in versioned workflows to record “what this holon was derived from.”</p>
<p>Example:
```rust,ignore
reference.with_predecessor(context, Some(prev_ref))?;
<div class="highlight"><pre><span></span><code>To clear a predecessor link, pass `None`.

---

### Summary of writable operations

| Operation               | Purpose                    | Typical use                                                 |
|-------------------------|----------------------------|-------------------------------------------------------------|
| `with_property_value`   | Set or replace a property. | Create or edit domain fields before staging or commit.      |
| `remove_property_value` | Remove a property.         | Clean up unused or obsolete fields.                         |
| `add_related_holons`    | Add linked holons.         | Associate new relationships (e.g., add tasks to a project). |
| `remove_related_holons` | Remove linked holons.      | Detach related entities.                                    |
| `with_descriptor`       | Assign a type descriptor.  | Loader-level operation for schema-driven creation.          |
| `with_predecessor`      | Record lineage.            | Used in versioned updates (`stage_new_version`).            |

---

### Example workflow

Here’s a typical editing flow for a staged holon:

```rust,ignore
// 1. Stage a new version of an existing holon
let staged = stage_new_version(context, saved_ref)?;

// 2. Update its properties
staged.with_property_value(context, &quot;title&quot;, &quot;Updated Title&quot;)?;
staged.with_property_value(context, CorePropertyTypeName::Status, &quot;Revised&quot;)?;

// 3. Add and remove related holons
staged.add_related_holons(context, &quot;HAS_CHILD&quot;, vec![child_a])?;
staged.remove_related_holons(context, &quot;HAS_CHILD&quot;, vec![child_b])?;

// 4. Commit all staged changes
let resp = commit(context)?;
println!(&quot;{} holons saved.&quot;, resp.saved_holons.len());
</code></pre></div></p>
<p>This demonstrates the complete writable lifecycle: create or stage → modify → commit.</p>
<hr />
<h3 id="error-conditions">Error conditions<a class="headerlink" href="#error-conditions" title="Permanent link">&para;</a></h3>
<p>All writable operations return <code>Result&lt;(), HolonError&gt;</code>.<br />
Common error cases:</p>
<ul>
<li><code>HolonError::NotAccessible</code> — write attempted on a read-only holon (<code>SmartReference</code>).</li>
<li><code>HolonError::InvalidHolonReference</code> — target or relationship not resolvable in the current context.</li>
<li><code>HolonError::InvalidType</code> — provided value type doesn’t match the property’s declared type.</li>
<li><code>HolonError::UnexpectedValueType</code> — incompatible runtime conversion.</li>
</ul>
<p>Writable APIs follow a <strong>fail-fast</strong> design — operations either succeed immediately or return a specific <code>HolonError</code> explaining what went wrong.</p>
<hr />
<p><strong>In summary:</strong><br />
WritableHolon methods make it easy to set, update, and link holons safely, with ergonomic property and relationship access, automatic type conversion, and strong context enforcement.</p>
<hr />
<h1 id="part-iv-collections-holoncollectionapi">Part IV – Collections (HolonCollectionApi)<a class="headerlink" href="#part-iv-collections-holoncollectionapi" title="Permanent link">&para;</a></h1>
<h2 id="9-working-with-collections-of-holons">9. Working with collections of holons<a class="headerlink" href="#9-working-with-collections-of-holons" title="Permanent link">&para;</a></h2>
<p>A <code>HolonCollection</code> represents an unordered set of holon references—often returned when traversing relationships.</p>
<h3 id="access-and-iteration">Access and iteration<a class="headerlink" href="#access-and-iteration" title="Permanent link">&para;</a></h3>
<p>```rust,ignore
let count   = tasks.len();
let first   = tasks.first();
let by_index  = tasks.get(2);
for holon_ref in &amp;tasks {
    println!("{:?}", holon_ref.key(context)?);
}
<div class="highlight"><pre><span></span><code>### Membership and lookup
```rust,ignore
if tasks.contains(&amp;some_ref) {
    println!(&quot;Already linked!&quot;);
}
</code></pre></div></p>
<p>```rust,ignore
if let Some(found) = tasks.get_by_key(&amp;MapString("task-42".into())) {
    println!("Found task 42: {:?}", found.key(context)?);
}
<div class="highlight"><pre><span></span><code>### Mutation
Available only for transient and staged holons.

```rust,ignore
tasks.add(context, HolonReference::Transient(new_task_ref))?;
tasks.remove(context, HolonReference::Smart(old_task_ref))?;
</code></pre></div></p>
<hr />
<h1 id="part-v-queries">Part V – Queries<a class="headerlink" href="#part-v-queries" title="Permanent link">&para;</a></h1>
<h2 id="10-querying-holons">10. Querying holons<a class="headerlink" href="#10-querying-holons" title="Permanent link">&para;</a></h2>
<p>The query layer provides a high-level way to search for holons that meet specific criteria.</p>
<h3 id="example">Example<a class="headerlink" href="#example" title="Permanent link">&para;</a></h3>
<p>```rust,ignore
let expr = QueryExpression::property_equals(P::Title, "Hello".into());
let nodes: NodeCollection = run_query(context, expr)?;
for node in nodes {
    println!("Found: {:?}", node.key(context)?);
}
<div class="highlight"><pre><span></span><code>&gt; Note: The query API is evolving and currently supports basic property and relationship predicates.

---

# Part VI – Cross-cutting Topics

## 11. Access Control

| AccessType | Transient | Staged | Smart |
|------------|-----------|--------|-------|
| Read       | ✅         | ✅      | ✅     |
| Write      | ✅         | ✅      | ❌     |
| Clone      | ✅         | ✅      | ✅     |
| Commit     | ❌         | ✅      | ❌     |
| Abandon    | ✅         | ✅      | ❌     |

Unauthorized actions raise `HolonError::NotAccessible`.

---

## 12. Error Handling

All MAP API functions return `Result&lt;_, HolonError&gt;`.  This unified error type is used consistently across the reference layer and ensures that mApp code can handle errors uniformly—whether they originate in the local runtime, the staging layer, or a distributed DHT operation.

---

### How errors propagate

1. **Local logic errors** (e.g., missing property, invalid type) are raised directly by reference-layer methods.
2. **Access control errors** are enforced by context and reference kind before reaching service layers.
3. **Service errors** (e.g., during commit or DHT access) bubble up through the same `HolonError` type for consistent handling.

When using `?`, errors automatically propagate to the caller; explicit matches can be used for fine-grained control.

Example:

```rust,ignore
match reference.property_value(context, &quot;title&quot;) {
    Ok(Some(val)) =&gt; println!(&quot;Title: {:?}&quot;, val.as_string()),
    Ok(None) =&gt; println!(&quot;Title missing.&quot;),
    Err(HolonError::NotAccessible) =&gt; println!(&quot;You do not have read access.&quot;),
    Err(err) =&gt; eprintln!(&quot;Unexpected error: {:?}&quot;, err),
}
</code></pre></div></p>
<hr />
<h3 id="error-categories">Error categories<a class="headerlink" href="#error-categories" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Category</th>
<th>Typical causes</th>
<th>Handling strategy</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Access</strong></td>
<td>Attempted write or read on an inaccessible holon or context.</td>
<td>Verify reference kind and permissions.</td>
</tr>
<tr>
<td><strong>Resolution</strong></td>
<td>Reference could not be found or resolved.</td>
<td>Check that the target holon exists in the current space.</td>
</tr>
<tr>
<td><strong>Schema / Type</strong></td>
<td>Property value type mismatches or missing required fields.</td>
<td>Validate property types before assignment; use defaults for missing values.</td>
</tr>
<tr>
<td><strong>Persistence / Service</strong></td>
<td>Errors during staging, commit, or DHT operations.</td>
<td>Retry commit or surface to user; check <code>CommitResponse</code> for details.</td>
</tr>
<tr>
<td><strong>Internal</strong></td>
<td>Unexpected internal conditions or bugs.</td>
<td>Log and escalate.</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="mapping-to-responsestatuscode">Mapping to ResponseStatusCode<a class="headerlink" href="#mapping-to-responsestatuscode" title="Permanent link">&para;</a></h3>
<p>When holon operations are invoked through Dances, <code>HolonError</code> variants are automatically mapped to appropriate <code>ResponseStatusCode</code> values (e.g., <code>BadRequest</code>, <code>Conflict</code>, <code>ServerError</code>).<br />
This allows API clients to interpret results consistently across in-process and distributed boundaries.</p>
<hr />
<h3 id="best-practices">Best practices<a class="headerlink" href="#best-practices" title="Permanent link">&para;</a></h3>
<ul>
<li>Use <strong>pattern matching</strong> to handle expected errors gracefully (e.g., missing properties).</li>
<li>Use the <strong><code>?</code> operator</strong> when you want errors to bubble up.</li>
<li>Always log or display <code>HolonError::message()</code> when debugging.</li>
<li>Treat <code>HolonError::InternalError</code> as a bug indicator — report it.</li>
</ul>
<p>For a complete list of <code>HolonError</code> variants, see <strong>Appendix B – HolonError Reference</strong>.</p>
<hr />
<h2 id="13-style-conventions">13. Style &amp; Conventions<a class="headerlink" href="#13-style-conventions" title="Permanent link">&para;</a></h2>
<ul>
<li>Use explicit suffixes (<code>*_reference</code>) for reference variables.</li>
<li>When APIs expect <code>Vec&lt;HolonReference&gt;</code>, wrap explicitly:</li>
</ul>
<p>```rust,ignore
HolonReference::Transient(transient_reference)
<div class="highlight"><pre><span></span><code>---

## 14. Where to Look

* **Prelude:** `holons_prelude::prelude`
* **Context behavior:** `reference_layer/context_behavior.rs`
* **Operations API:** `reference_layer/holon_operations_api.rs`
* **Reference traits and types:** `reference_layer/holon_reference.rs`, `readable_holon.rs`, `writable_holon.rs`, `staged_reference.rs`, `transient_reference.rs`
* **Access and state:** `core_shared_objects/holon/state.rs`
* **Dance builders:** `holon_dance_builders`
* **Query layer:** `reference_layer/query_api.rs`

---

## 15. Evolving Areas

* Validation runs primarily at commit.
* Fluent chaining (`&amp;Self`) is being standardized in setters.
* The query API will expand to richer predicates.
* Additional Dances (Loader, Validation) will reuse the same reference layer interface.

---

# Appendix A – API Quick Reference Card

## HolonOperationsApi

```rust,ignore
fn new_holon(
    context: &amp;dyn HolonsContextBehavior,
    type_name: MapString,
) -&gt; TransientReference;

fn stage_new_holon_api(
    context: &amp;dyn HolonsContextBehavior,
    transient: TransientReference,
) -&gt; Result&lt;StagedReference, HolonError&gt;;

fn stage_new_version(
    context: &amp;dyn HolonsContextBehavior,
    current_version: SmartReference,
) -&gt; Result&lt;StagedReference, HolonError&gt;;

fn stage_new_from_clone(
    context: &amp;dyn HolonsContextBehavior,
    original_holon: HolonReference,
    new_key: MapString,
) -&gt; Result&lt;StagedReference, HolonError&gt;;

fn commit_api(
    context: &amp;dyn HolonsContextBehavior,
) -&gt; Result&lt;CommitResponse, HolonError&gt;;
</code></pre></div></p>
<hr />
<h2 id="readableholon">ReadableHolon<a class="headerlink" href="#readableholon" title="Permanent link">&para;</a></h2>
<p>```rust,ignore
fn key(&amp;self, context: &amp;dyn HolonsContextBehavior)
    -&gt; Result<Option\<MapString>, HolonError>;</p>
<p>fn versioned_key(&amp;self, context: &amp;dyn HolonsContextBehavior)
    -&gt; Result<VersionedKey, HolonError>;</p>
<p>fn property_value(
    &amp;self,
    context: &amp;dyn HolonsContextBehavior,
    property_name: &amp;PropertyName,
) -&gt; Result<Option\<PropertyValue>, HolonError>;</p>
<p>fn related_holons(
    &amp;self,
    context: &amp;dyn HolonsContextBehavior,
    relationship_name: &amp;RelationshipName,
) -&gt; Result<HolonCollection, HolonError>;</p>
<p>fn all_related_holons(
    &amp;self,
    context: &amp;dyn HolonsContextBehavior,
) -&gt; Result<BTreeMap\<RelationshipName, HolonCollection>, HolonError>;</p>
<p>fn holon_id(&amp;self, context: &amp;dyn HolonsContextBehavior)
    -&gt; Result<HolonId, HolonError>;</p>
<p>fn predecessor(&amp;self, context: &amp;dyn HolonsContextBehavior)
    -&gt; Result<Option\<HolonReference>, HolonError>;</p>
<p>fn essential_content(&amp;self, context: &amp;dyn HolonsContextBehavior)
    -&gt; Result<EssentialHolonContent, HolonError>;</p>
<div class="highlight"><pre><span></span><code>---

## WritableHolon

```rust,ignore
fn with_property_value(
    &amp;self,
    context: &amp;dyn HolonsContextBehavior,
    property_name: CorePropertyTypeName,
    value: PropertyValue,
) -&gt; Result&lt;(), HolonError&gt;;

fn remove_property_value(
    &amp;self,
    context: &amp;dyn HolonsContextBehavior,
    property_name: CorePropertyTypeName,
) -&gt; Result&lt;(), HolonError&gt;;

fn add_related_holons(
    &amp;self,
    context: &amp;dyn HolonsContextBehavior,
    relationship_name: RelationshipName,
    targets: Vec&lt;HolonReference&gt;,
) -&gt; Result&lt;(), HolonError&gt;;

fn remove_related_holons(
    &amp;self,
    context: &amp;dyn HolonsContextBehavior,
    relationship_name: RelationshipName,
    targets: Vec&lt;HolonReference&gt;,
) -&gt; Result&lt;(), HolonError&gt;;

fn with_descriptor(
    &amp;self,
    context: &amp;dyn HolonsContextBehavior,
    descriptor_ref: HolonReference,
) -&gt; Result&lt;(), HolonError&gt;;

fn with_predecessor(
    &amp;self,
    context: &amp;dyn HolonsContextBehavior,
    predecessor_ref: Option&lt;HolonReference&gt;,
) -&gt; Result&lt;(), HolonError&gt;;
</code></pre></div>
<hr />
<h2 id="holoncollectionapi">HolonCollectionApi<a class="headerlink" href="#holoncollectionapi" title="Permanent link">&para;</a></h2>
<p>```rust,ignore
fn len(&amp;self) -&gt; usize;
fn is_empty(&amp;self) -&gt; bool;
fn first(&amp;self) -&gt; Option&lt;&amp;HolonReference&gt;;
fn get(&amp;self, index: usize) -&gt; Option&lt;&amp;HolonReference&gt;;
fn get_by_key(&amp;self, key: &amp;MapString) -&gt; Option&lt;&amp;HolonReference&gt;;
fn contains(&amp;self, target: &amp;HolonReference) -&gt; bool;
fn to_vec(&amp;self) -&gt; Vec<HolonReference>;
fn add(
    &amp;self,
    context: &amp;dyn HolonsContextBehavior,
    target: HolonReference,
) -&gt; Result&lt;(), HolonError&gt;;
fn remove(
    &amp;self,
    context: &amp;dyn HolonsContextBehavior,
    target: HolonReference,
) -&gt; Result&lt;(), HolonError&gt;;
<div class="highlight"><pre><span></span><code>---

## Query Layer

```rust,ignore
fn property_equals(
    property_name: CorePropertyTypeName,
    value: PropertyValue,
) -&gt; QueryExpression;

fn run_query(
    context: &amp;dyn HolonsContextBehavior,
    expr: QueryExpression,
) -&gt; Result&lt;NodeCollection, HolonError&gt;;
</code></pre></div></p>
<hr />
<p>This appendix serves as a concise <strong>signature-only</strong> reference for all key API areas, grouped by their functional domains.</p>
<hr />
<h1 id="appendix-b-holonerror-reference">Appendix B – HolonError Reference<a class="headerlink" href="#appendix-b-holonerror-reference" title="Permanent link">&para;</a></h1>
<p>The <code>HolonError</code> enum defines all possible error conditions that may occur while working with holons.<br />
Each variant captures a distinct failure domain within the MAP reference layer.</p>
<table>
<thead>
<tr>
<th>Variant</th>
<th>Description</th>
<th>Common Origin</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><code>NotAccessible</code></strong></td>
<td>Operation not permitted under current context/kind combination.</td>
<td>Attempting to modify a <code>SmartReference</code>; restricted access context.</td>
</tr>
<tr>
<td><strong><code>InvalidHolonReference</code></strong></td>
<td>Reference cannot be resolved or is malformed.</td>
<td>Dangling or out-of-scope references; deleted holons.</td>
</tr>
<tr>
<td><strong><code>InvalidType</code></strong></td>
<td>The provided value or descriptor does not match the expected type.</td>
<td>Assigning the wrong <code>ValueType</code> or <code>Descriptor</code>.</td>
</tr>
<tr>
<td><strong><code>UnexpectedValueType</code></strong></td>
<td>Runtime value type mismatch (e.g., expected string, found integer).</td>
<td>Property read or write with incompatible type.</td>
</tr>
<tr>
<td><strong><code>EmptyField</code></strong></td>
<td>A required field or property is missing or empty.</td>
<td>Validation of incomplete holon data.</td>
</tr>
<tr>
<td><strong><code>MissingDescriptor</code></strong></td>
<td>The holon lacks an associated type descriptor.</td>
<td>Loader or schema definition error.</td>
</tr>
<tr>
<td><strong><code>MissingRelationship</code></strong></td>
<td>A requested relationship does not exist.</td>
<td>Using an undefined relationship name.</td>
</tr>
<tr>
<td><strong><code>DuplicateKey</code></strong></td>
<td>Attempted to create or stage a holon with a key that already exists.</td>
<td>Staging or import conflicts.</td>
</tr>
<tr>
<td><strong><code>StagingConflict</code></strong></td>
<td>Two staged holons conflict on lineage or key.</td>
<td>Concurrent edits in the Nursery.</td>
</tr>
<tr>
<td><strong><code>CommitFailure</code></strong></td>
<td>One or more holons failed to commit.</td>
<td>DHT or persistence layer error.</td>
</tr>
<tr>
<td><strong><code>Abandoned</code></strong></td>
<td>The holon was marked abandoned during commit.</td>
<td>Validation failure during persistence.</td>
</tr>
<tr>
<td><strong><code>InvalidContext</code></strong></td>
<td>The provided context is invalid or no longer active.</td>
<td>Using an expired or mismatched context reference.</td>
</tr>
<tr>
<td><strong><code>SerializationError</code></strong></td>
<td>Failure to encode or decode a holon or property value.</td>
<td>Cross-boundary transmission or storage.</td>
</tr>
<tr>
<td><strong><code>DeserializationError</code></strong></td>
<td>Failure to parse persisted data into a holon.</td>
<td>Import or cache corruption.</td>
</tr>
<tr>
<td><strong><code>NetworkError</code></strong></td>
<td>Communication failure with remote service or DHT.</td>
<td>Distributed commit or fetch.</td>
</tr>
<tr>
<td><strong><code>InternalError</code></strong></td>
<td>Unexpected internal condition.</td>
<td>Logic bugs or invariant violations.</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="example-usage-in-pattern-matches">Example usage in pattern matches<a class="headerlink" href="#example-usage-in-pattern-matches" title="Permanent link">&para;</a></h3>
<p><code>rust,ignore
match commit(context) {
    Ok(resp) if resp.is_complete() =&gt; println!("Commit succeeded!"),
    Ok(resp) =&gt; eprintln!("Partial commit: {:?}", resp.summary()),
    Err(HolonError::CommitFailure) =&gt; eprintln!("Commit failed."),
    Err(HolonError::NetworkError) =&gt; eprintln!("Network issue, retry later."),
    Err(e) =&gt; eprintln!("Unhandled error: {:?}", e),
}</code></p>
<hr />
<h3 id="notes">Notes<a class="headerlink" href="#notes" title="Permanent link">&para;</a></h3>
<ul>
<li>Most variants are recoverable — for example, <code>StagingConflict</code> and <code>DuplicateKey</code> can be retried after correction.</li>
<li>Use <code>HolonError::to_string()</code> for concise error summaries in logs.</li>
<li><code>InternalError</code> and <code>InvalidContext</code> indicate deeper systemic problems that typically warrant investigation.</li>
</ul>
<p>Together, these definitions provide a full picture of how the MAP reference layer communicates problems — predictably, type-safely, and with context.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../../mapp-dev/trust-channel/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Trust Channels">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Trust Channels
              </div>
            </div>
          </a>
        
        
          
          <a href="../map-type-system-revised/" class="md-footer__link md-footer__link--next" aria-label="Next: MAP Type System">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                MAP Type System
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "search.highlight", "navigation.top", "navigation.footer", "content.action.edit"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>