
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.11">
    
    
      
        <title>MAP testing follows two general approaches: - MAP Developer Docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="cyan">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#map-testing-follows-two-general-approaches" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="MAP Developer Docs" class="md-header__button md-logo" aria-label="MAP Developer Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            MAP Developer Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              MAP testing follows two general approaches:
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="cyan"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="cyan"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="MAP Developer Docs" class="md-nav__button md-logo" aria-label="MAP Developer Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    MAP Developer Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Mapp Developers
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Mapp Developers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mapp-dev/rust-api-developers-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Developers Guide to the MAP Rust-API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mapp-dev/holon-data-loader-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Holon Data Loader Guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mapp-dev/holon-loader-man-page/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Holon Data Loader CLI Man Page
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mapp-dev/tags_to_memes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tags to Memes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mapp-dev/extensibility-model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    The MAP Extensibility Model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mapp-dev/trust-channel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Trust Channels
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../map-content-distribution-arch.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    A Sovereign Content Distribution Architecture
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Visualizer Developers
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    MAP Core
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            MAP Core
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../map-deployment-arch/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deployment Architecture
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../map-type-system-revised/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MAP Type System
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../transaction-model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MAP Transaction Model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../on-boarding/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    On-Boarding Flow
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dances-design/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dances Design Spec
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../capsulization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Capsulization Strategy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../trust-channel-design-spec/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Trust Channel Design Spec
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../holon-data-loader-design-spec/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Holon Loader Spec
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../meta-value-types-import-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Meta-Value Import Guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../i18n-design-spec/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Internationalization Design Spec
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../wasm-crate-guidelines/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Workspace Structure and WASM Guidelines
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Shared Concepts
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../shared/glossary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Glossary
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sweetest-integration-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Sweetest Integration Tests
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Sweetest Integration Tests">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test-contexts" class="md-nav__link">
    <span class="md-ellipsis">
      Test Contexts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Test Contexts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fixture_context-client-side" class="md-nav__link">
    <span class="md-ellipsis">
      fixture_context (client-side)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_context-client-side" class="md-nav__link">
    <span class="md-ellipsis">
      test_context (client-side)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#guest_context-guest-side" class="md-nav__link">
    <span class="md-ellipsis">
      guest_context (guest-side)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rstest_dance_tests-function" class="md-nav__link">
    <span class="md-ellipsis">
      rstest_dance_tests Function
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="map-testing-follows-two-general-approaches">MAP testing follows two general approaches:<a class="headerlink" href="#map-testing-follows-two-general-approaches" title="Permanent link">&para;</a></h1>
<ol>
<li>Sweetests leverage Rust's <a href="https://app.capacities.io/5b8fa8cb-93e4-49ef-a28d-a7b25cd445b4/2ac07cf0-6bba-4698-987a-b289fe408e2b">rstest</a> testing framework.</li>
<li>Tryorama tests leverages Holochain's <a href="https://app.capacities.io/5b8fa8cb-93e4-49ef-a28d-a7b25cd445b4/3183dcce-255e-411e-b1c5-0d27153c2faf">Tryorama</a> JavaScript-based testing framework.</li>
</ol>
<h2 id="sweetest-integration-tests">Sweetest Integration Tests<a class="headerlink" href="#sweetest-integration-tests" title="Permanent link">&para;</a></h2>
<h3 id="test-contexts">Test Contexts<a class="headerlink" href="#test-contexts" title="Permanent link">&para;</a></h3>
<p>The <code>HolonsContextBehavior</code> trait provides access to a space manager.</p>
<div class="highlight"><pre><span></span><code>pub trait HolonsContextBehavior {
    /// Provides access to the holon space manager for interacting with holons and their relationships.
    fn get_space_manager(&amp;self) -&gt; Rc&lt;&amp;dyn HolonSpaceBehavior&gt;;
}
</code></pre></div>
<p>Concrete implementations of that trait provide access to a HolonSpaceManager that has been configured for either <em>client-side</em> or <em>guest-side</em> use. Note that HolonSpaceManager is a holons_core component, so the source code is the same for both client and guest space managers. They differ in the HolonService they have been injected with upon initialization of their context.</p>
<p>The <code>HolonSpaceBehavior</code> trait implemented by HolonSpaceManager provides access to a set of services.</p>
<div class="highlight"><pre><span></span><code>pub trait HolonSpaceBehavior {
    fn get_cache_access(&amp;self) -&gt; Arc&lt;dyn HolonCacheAccess&gt;;
    fn get_holon_service(&amp;self) -&gt; Arc&lt;dyn HolonServiceApi&gt;;
    fn get_nursery_access(&amp;self) -&gt; Arc&lt;RefCell&lt;dyn NurseryAccess&gt;&gt;;
    fn get_space_holon(&amp;self) -&gt; Option&lt;HolonReference&gt;;
    fn get_staging_behavior_access(&amp;self) -&gt; Arc&lt;RefCell&lt;dyn HolonStagingBehavior&gt;&gt;;
    fn export_staged_holons(&amp;self) -&gt; SerializableHolonPool;
    fn import_staged_holons(&amp;self, staged_holons: SerializableHolonPool);
    fn get_transient_state(&amp;self) -&gt; Rc&lt;RefCell&lt;dyn HolonCollectionApi&gt;&gt;;
}
</code></pre></div>
<p>There are three different contexts relevant to sweetests.</p>
<h4 id="fixture_context-client-side">fixture_context (client-side)<a class="headerlink" href="#fixture_context-client-side" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Test fixtures are responsible for setting up the test steps for a given test case along with the test data (holons and relationships) those steps require. Notice that relationships are expressed via <code>HolonReferences</code>. The <code>fixture_context</code> allows access to the actually holon they being references by providing access to the services that resolve them: <code>CacheAccess</code> (for <code>SmartReferences</code>) or <code>NurseryAccess</code> (for <code>StagedReferences</code>).</p>
</li>
<li>
<p>An empty context is initialized by each fixture and goes out of scope when the fixture ends. <em>Fixture contexts</em> are never shipped between client and guest and their <code>Nursery's</code> are never <em>committed</em>.</p>
</li>
</ul>
<h4 id="test_context-client-side">test_context (client-side)<a class="headerlink" href="#test_context-client-side" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Each test case executes within its own client-side context. Test step executors (i.e., the rust functions that implement test steps), use the test_context to stage holons and their relationships (via the NurseryAccess service) and to get persisted holons and their relationships (via the CacheAccess service).</p>
</li>
<li>
<p>an <strong>empty context</strong> is initialized by the <code>rstest_dance_test</code> function at the beginning of each test case execution and a reference to it (as a <code>&amp;dyn HolonsContextBehavior</code> trait object) is passed as a parameter to each test step executor.
  if a test step invokes a <em>dance</em>, its <code>Nursery</code> is shipped to the guest-side via the <code>session_state</code> field on <code>DanceRequest</code>.</p>
</li>
<li>when the dance result is returned the <code>test_context</code> is restored from <code>session_state</code> so that any changes to the <code>Nursery</code> that were made by the guest are now reflected back in the client's <code>Nursery</code>.</li>
<li>the <code>commit_dance</code> persists any staged holons in the <code>Nursery</code>. Once completed successfully, it clears the staged holons and keyed_index from the Nursery, making it available to stage additional holons and relationships.</li>
</ul>
<h4 id="guest_context-guest-side">guest_context (guest-side)<a class="headerlink" href="#guest_context-guest-side" title="Permanent link">&para;</a></h4>
<ul>
<li>The guest_context is used by dance implementation functions that rely on the space manager and the services it provides.</li>
<li>When Dancer's dance function is invoked for a new DanceRequest, it initializes the guest_context from the session_state passed via the DanceRequest.</li>
<li>The dancer passes a reference to the context (as a <code>&amp;dyn HolonsContextBehavior</code> trait object) to the DanceFunction it dispatches to handle the dance request.</li>
<li>DanceFunctions may perform operations that add, remove, update or clear the Nursery.</li>
<li>The dancer is responsible for including the updated Nursery via the session_state field in the DanceResponse.</li>
</ul>
<h3 id="rstest_dance_tests-function">rstest_dance_tests Function<a class="headerlink" href="#rstest_dance_tests-function" title="Permanent link">&para;</a></h3>
<p>Sweetests are organized around a set of test cases. Since the external API to the MAP guest is organized around dances, all integration testing is driven from the dances crate -- specifically, the <code>rstest_dance_tests</code> function defined in the <code>dances_tests.rs</code> module.</p>
<div class="highlight"><pre><span></span><code>#[rstest]
#[case::simple_undescribed_create_holon_test(simple_create_holon_fixture())]
#[case::simple_add_related_holon_test(simple_add_remove_related_holons_fixture())]

#[tokio::test(flavor = &quot;multi_thread&quot;)]
async fn rstest_dance_tests(#[case] input: Result&lt;DancesTestCase, HolonError&gt;)
</code></pre></div>
<p>Notice this function is parameterized by <code>#[case]</code>. Preceding the function declaration with one or more <code>#[case]</code> statements allows selective control over which test cases are invoked in any given test run. For example, the following code will result in the <code>rstest_dance_tests</code> function being invoked twice -- once for the <code>simple_undescribed_create_holon_test</code> case and once for the <code>simple_add_related_holon_test</code> case. Each test case is invoked asynchronously and independently from other test cases.</p>
<p>Each case has an associated <em>fixture function</em> that sets up the test steps and associated data for that test case and returns a <code>DancesTestCase</code> object that is passed as an input parameter to the <code>rstest_dance_tests</code> function. Every test case follows the same basic flow:
1. <em><strong>Initialization</strong></em> -- sets up tracing, a mock conductor, an empty <code>HolonsContext</code>, and an empty <code>test_state</code>. Note that <code>test_context</code> is different from the <code>fixture_context</code> used by the fixture and the <code>guest_context</code> used by the back-end (guest-side) during dance execution (as described above).
2. <em><strong>Test Step Execution</strong></em>. Unpack the test case and iterate through the steps for that test case. Matching on the test step allows different <code>execute_xxx</code> functions to be dispatched for each kind of test step.</p>
<p>The <code>test_state</code> accumulates state as the test case progresses and a mutable reference to it is passed into every test step executor.</p>
<div class="highlight"><pre><span></span><code>// from dances/tests/shared_test/test_data_types.rs
pub struct DanceTestState {
    pub session_state: SessionState,
    pub created_holons: BTreeMap&lt;MapString, Holon&gt;,
}
</code></pre></div>
<p>The <code>session_state</code> field holds the state that is ping-ponged back and forth between client and guest. The <code>created_holons</code> map allows holons that have been successfully committed during the execution of this test case to be retrieved via their key in later test steps.</p>
<div class="highlight"><pre><span></span><code>// from dances/src/session_state.rs
pub struct SessionState {
    staging_area: StagingArea,
    local_holon_space: Option&lt;HolonReference&gt;,
}

// from dances/src/staging_area.rs
pub struct StagingArea {
    staged_holons: Vec&lt;Holon&gt;,         // Contains all holons staged for commit
    index: BTreeMap&lt;MapString, usize&gt;, // Allows lookup by key to staged holons for which keys are defined
}
</code></pre></div>
<p>The <code>session_state</code> is included as part of the <code>DanceRequest</code> by the <code>build_xxx_</code> function. It is part of every dance call and is restored from the <code>DanceResponse</code> when a response is received.</p>
<p>```let response: DanceResponse = conductor.call(&amp;_cell.zome("dances"), "dance", valid_request).await;
_test_state.session_state = response.state.clone();
<div class="highlight"><pre><span></span><code>## Test Fixtures
Each case has an associated fixture function that sets up the test steps and associated data for that test case and returns a `DancesTestCase` object that is passed as an input parameter to the `rstest_dance_tests` function. The fixture can stage a set of holons and relationships in its `fixture_context`. Such holons can be supplied to the `test_steps` the fixture is setting up in order to supply the data required by that `test_step`.

## Test Data Types

We have defined a set of data structures and protocols designed to make it easier to quickly define test cases.

### DanceTestStep

Each test case is composed of a set of test steps. Test steps are defined independently so that may be reused in different test cases. The `DanceTestStep` enum defines the set of available test steps and the data associated with each test step. Here is an excerpt:
</code></pre></div>
pub enum DanceTestStep {
  AbandonStagedChanges(StagedReference, ResponseStatusCode), // Marks a staged Holon as 'abandoned'
    AddRelatedHolons(
        StagedReference,
        RelationshipName,
        Vec<HolonReference>,
        ResponseStatusCode,
        Holon,
    ), // Adds relationship between two Holons
    Commit,      </p>
<p>}
<div class="highlight"><pre><span></span><code>Each test step generally invokes one or more dances.

### DancesTestCase

Each test case is defined by an instance of DancesTestCase:
</code></pre></div>
pub struct DancesTestCase {
    pub name: String,
    pub description: String,
    pub steps: VecDeque<DanceTestStep>,
    pub test_session_state: TestSessionState,
}</p>
<p>pub struct TestSessionState {
    transient_holons: SerializableHolonPool,
}
<div class="highlight"><pre><span></span><code>Including `test_session_state` in the `DancesTestCase` allows the TransientHolons created by a fixture to be passed from the `fixture_context` into the `test_context`. As part of its initialization sequence, the `rstest_dance_tests` function initializes its `test_context` from the `test_session_state`. This means the `test_context&#39;s` TransientHolonManager will start with its HolonPool in the same state as the `fixture_context&#39;s` HolonPool. **_Key Takeaway: any TransientReferences created by the fixture are resolvable within the test_context_**. However, the fixtures Nursery is NOT passed into the test context. This means that StagedReferences created in the fixture are NOT resolvable in the `test_context`. For this reason, _**fixtures should NOT, themselves, stage any holons.**_

Notice that the test case defines a sequential set of steps. `DancesTestCase` offers a set of `add_xxx_step` methods that allow test steps to be added to the test case, where xxx specifies a particular a specific test step. For example, the following method adds a stage_holon_step to test case.
</code></pre></div>
 pub fn add_stage_holon_step(&amp;mut self, holon: TransientReference) -&gt; Result&lt;(), HolonError&gt; {
        self.steps.push_back(DanceTestStep::StageHolon(holon));
        Ok(())
    }
<div class="highlight"><pre><span></span><code>Notice the holon to be staged is identified via its TransientReference. Since this reference will resolve in the test_context, the test_stage_new_holon function can resolve that reference during test execution.

### Referencing Holons Staged or Saved within a Test Case Execution

Some test cases require the ability to refer to holons staged or saved in earlier test steps. For example, suppose I want to add related holons (either staged or saved) to a holon staged in a prior step. Likewise, in the `stage_new_from_clone` test case we want to test the ability so clone a transient holon, staged holon, and saved holon (to make sure all three possibilities are tested).

The fixture doesn&#39;t know what temporary id the test executor will assign for the holons staged during the test, nor does it know what HolonId will be assigned by holochain for holons committed to the DHT during the test. **_So how can it pass references to those holon to subsequent steps it is adding to the test case?_**


### Current Approach: Test References and DanceTestExecutionState

Our current solution was implemented prior to the introduction of the TransientHolonManager. This section describes the current approach and is then followed by a proposed approach.
</code></pre></div>
pub struct DanceTestExecutionState<C: ConductorDanceCaller> {
    context: Arc<dyn HolonsContextBehavior>,
    pub dance_call_service: Arc<DanceCallService\<C>>,
    pub created_holons: BTreeMap<MapString, Holon>,
}
<div class="highlight"><pre><span></span><code>### TestReference

`TestReferences` are created by fixtures. They are used to pass references to holons created in prior test steps to be passed into subsequent test steps. For example, the `simple_stage_new_from_clone_fixture`:

1. Stages several holons into the fixture&#39;s Nursery
2. Adds a `stage_new_from_clone_step` to the TestCase that (during execution phase) will stage a new holon that is a clone of one of the previously staged holons.
2. Adds a stageClones the staged holon
3. Phase 2 clones a saved holon, changes some of its\n\
   properties, adds a relationship, commits it and then compares essential content of existing \n\
   holon and cloned holon
</code></pre></div>
pub enum TestReference {
    SavedHolon(MapString),
    StagedHolon(StagedReference),
    TransientHolon(TransientReference),
}
```</p>
<h1 id="tryorama-tests-tbd">Tryorama Tests (TBD)<a class="headerlink" href="#tryorama-tests-tbd" title="Permanent link">&para;</a></h1>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "search.highlight", "navigation.top", "navigation.footer", "content.action.edit"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>